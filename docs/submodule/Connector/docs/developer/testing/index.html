<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-submodule/Connector/docs/developer/testing">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">Writing Tests | My Site</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://FraunhoferISST.github.io/edc-docs/docs/submodule/Connector/docs/developer/testing"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Writing Tests | My Site"><meta data-rh="true" name="description" content="Adding EDC test fixtures"><meta data-rh="true" property="og:description" content="Adding EDC test fixtures"><link data-rh="true" rel="icon" href="/edc-docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://FraunhoferISST.github.io/edc-docs/docs/submodule/Connector/docs/developer/testing"><link data-rh="true" rel="alternate" href="https://FraunhoferISST.github.io/edc-docs/docs/submodule/Connector/docs/developer/testing" hreflang="en"><link data-rh="true" rel="alternate" href="https://FraunhoferISST.github.io/edc-docs/docs/submodule/Connector/docs/developer/testing" hreflang="x-default"><link rel="stylesheet" href="/edc-docs/assets/css/styles.5bd81ef5.css">
<link rel="preload" href="/edc-docs/assets/js/runtime~main.bbc09bb1.js" as="script">
<link rel="preload" href="/edc-docs/assets/js/main.bdd0bebb.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/edc-docs/"><div class="navbar__logo"><img src="/edc-docs/img/icon.png" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/edc-docs/img/icon.png" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a><a class="navbar__item navbar__link" href="/edc-docs/docs/">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/eclipse-dataspacecomponents/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><main class="docMainContainer_gTbr docMainContainerEnhanced_Uz_u"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Writing Tests</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="adding-edc-test-fixtures">Adding EDC test fixtures<a class="hash-link" href="#adding-edc-test-fixtures" title="Direct link to heading">​</a></h2><p>To add EDC test utilities and test fixtures to downstream projects, simply add the following Gradle dependency:</p><div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  testImplementation(&quot;org.eclipse.edc:common-junit:&lt;version&gt;&quot;)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="controlling-test-verbosity">Controlling test verbosity<a class="hash-link" href="#controlling-test-verbosity" title="Direct link to heading">​</a></h2><p>To run tests verbosely (displaying test events and output and error streams to the console), use the following system
property:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./gradlew </span><span class="token builtin class-name">test</span><span class="token plain"> -PverboseTest</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="definition-and-distinction">Definition and distinction<a class="hash-link" href="#definition-and-distinction" title="Direct link to heading">​</a></h2><ul><li><em>unit tests</em> test one single class by stubbing or mocking dependencies.</li><li><a href="#integration-tests"><em>integration test</em></a> tests one particular aspect of a software, which may involve external
systems.</li><li><a href="#system-tests"><em>system tests</em></a> are end-2-end tests that rely on the <em>entire</em> system to be present.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="integration-tests">Integration Tests<a class="hash-link" href="#integration-tests" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="tldr">TL;DR<a class="hash-link" href="#tldr" title="Direct link to heading">​</a></h3><p>Use integration tests only when necessary, keep them concise, implement them in a defensive manner using timeouts and
randomized names, setup external systems during the workflow.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="when-to-use-them">When to use them<a class="hash-link" href="#when-to-use-them" title="Direct link to heading">​</a></h3><p>Generally we should aim at writing unit tests rather than integration tests, because they are simpler, more stable and
typically run faster. Sometimes that&#x27;s not (easily) possible, especially when an implementation relies on an external
system that is not easily mocked or stubbed such as cloud-based databases.</p><p>Therefore, in many cases writing unit tests is more involved that writing an integration test, for example say we wanted
to test our implementation of a CosmosDB-backed queue. We would have to mock the behaviour of the CosmosDB API, which -
while certainly possible - can get complicated pretty quickly. Now we still might do that for simpler scenarios, but
eventually we might want to write an integration test that uses a CosmosDB test instance.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="coding-guidelines">Coding Guidelines<a class="hash-link" href="#coding-guidelines" title="Direct link to heading">​</a></h3><p>EDC codebase has few annotations and these annotation focuses on two important aspects:</p><ul><li>Exclude integration tests by default from JUnit test runner as these tests relies on external systems which might not
be available during a local execution.</li><li>Categorize integration tests with help of
<a href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-tagging-and-filtering" target="_blank" rel="noopener noreferrer">JUnit Tags</a>.</li></ul><p>Following are some available annotations:</p><ul><li><code>@IntegrationTest</code>: Marks an integration test with <code>IntegrationTest</code> Junit tag. This is the default tag and can be
used if you do not want to specify any other tags on your test to do further categorization.</li></ul><p>Below annotations are used to categorize integration tests based on the runtime components that must be available for
the test to run. All of these annotations are composite annotations and contains <code>@IntegrationTest</code> annotation as well.</p><ul><li><code>@AzureStorageIntegrationTest</code>: Marks an integration test with <code>AzureStorageIntegrationTest</code> Junit tag. This should be
used when the integration test requires the Azure Storage emulator to run.</li><li><code>@AzureCosmosDbIntegrationTest</code>: Marks an integration test with <code>AzureCosmosDbIntegrationTest</code> Junit tag. This should
be used when the integration test requires the Azure CosmosDB emulator to run.</li><li><code>@AwsS3IntegrationTest</code>: Marks an integration test with <code>AwsS3IntegrationTest</code> Junit tag. This should be used when the
integration test requires the AWS S3 storage emulator to run.</li><li><code>@DapsTest</code>: Marks an integration test with <code>DapsIntegrationTest</code> Junit tag. This should be used when the integration
test is requires Daps IAM endpoint to run.</li><li><code>@OpenTelemetryIntegrationTest</code>: Marks an integration test with <code>OpenTelemetryIntegrationTest</code> Junit Tag. This should
be used for integration tests that require the
<a href="https://github.com/open-telemetry/opentelemetry-java-instrumentation" target="_blank" rel="noopener noreferrer">OpenTelemetry agent</a>, for example tests about
metrics and traces.</li><li><code>@EndToEndTest</code>: Marks an integration test with <code>EndToEndTest</code> Junit Tag. This should be used when entire system is</li><li>involved in a test.</li><li><code>@ComponentTest</code>: Marks an integration test with <code>ComponentTest</code> Junit Tag. This should be used when the test does not
use an external system, but uses actual collaborator objects instead of mocks.</li></ul><p>We encourage you to use these available annotation but if your integration test does not fit in one of these available
annotations, and you want to categorize them based on their technologies then feel free to create a new annotations but
make sure to use composite annotations which contains <code>@IntegrationTest</code>. If you do not wish to categorize based on
their technologies then you can use already available <code>@IntegrationTest</code> annotation.</p><ul><li>By default, JUnit test runner ignores all integration tests because in root <code>build.gradle.kts</code> file we have excluded
all tests marked with <code>IntegrationTest</code> Junit tag.</li><li>If your integration test does not rely on an external system then you may not want to use above-mentioned annotations.</li></ul><p>All integration tests should specify annotation to categorize them and the <code>&quot;...IntegrationTest&quot;</code> postfix to distinguish
them clearly from unit tests. They should reside in the same package as unit tests because all tests should maintain
package consistency to their test subject.</p><p>Any credentials, secrets, passwords, etc. that are required by the integration tests should be passed in using
environment variables. A good way to access them is <code>ConfigurationFunctions.propOrEnv()</code> because then the credentials
can also be supplied via system properties.</p><p>There is no one-size-fits-all guideline whether to perform setup tasks in the <code>@BeforeAll</code> or <code>@BeforeEach</code>, it will
depend on the concrete system you&#x27;re using. As a general rule of thumb long-running one-time setup should be done in
the <code>@BeforeAll</code> so as not to extend the run-time of the test unnecessarily. In contrast, in most cases it is <strong>not</strong>
advisable to deploy/provision the external system itself in either of those methods. In other words, provisioning a
CosmosDB or spinning up a Postgres docker container directly from test code should generally be avoided, because it will
introduce code that has nothing to do with the test and may cause security problems (privilege escalation through the
Docker API), etc.</p><p>This does not at all discourage the use of external test environments like containers, rather, the external system
should be deployed in the CI script (e.g. through Github&#x27;s <code>services</code> feature), or there might even be a dedicated test
instance running continuously, e.g. a CosmosDB test instance in Azure. In the latter case we need to be careful to avoid
conflicts (e.g. database names) when multiple test runners access that system simultaneously and to properly clean-up
any residue before and after the test.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="running-them-locally">Running them locally<a class="hash-link" href="#running-them-locally" title="Direct link to heading">​</a></h3><p>As mentioned above the JUnit runner won&#x27;t pick up integration tests unless a tag is provided. For example to run
<code>Azure CosmosDB</code> integration tests pass <code>includeTags</code> parameter with tag value to the <code>gradlew</code> command:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./gradlew </span><span class="token builtin class-name">test</span><span class="token plain"> -p path/to/module -DincludeTags</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;AzureCosmosDbIntegrationTest&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>if needed to run all types of tests(e.g. unit &amp; integration) then it can be achieved by passing the <code>runAllTests=true</code>
parameter to the <code>gradlew</code> command:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./gradlew </span><span class="token builtin class-name">test</span><span class="token plain"> -DrunAllTests</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;true&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>For example to run all integration tests from Azure cosmos db module and its sub-modules:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./gradlew -p extensions/azure/cosmos </span><span class="token builtin class-name">test</span><span class="token plain"> -DincludeTags</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;AzureCosmosDbIntegrationTest&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><em>Command as <code>./gradlew :extensions:azure:cosmos test -DincludeTags=&quot;AzureCosmosDbIntegrationTest&quot;</code> does not execute
tests from all sub-modules so we need to use <code>-p</code> to specify the module project path.</em></p><p>Cosmos DB integration tests are run by default against a locally
running <a href="https://docs.microsoft.com/azure/cosmos-db/local-emulator" target="_blank" rel="noopener noreferrer">Cosmos DB Emulator</a>. You can also use an instance of
Cosmos DB running in Azure, in which case you should set the <code>COSMOS_KEY</code> and <code>COSMOS_URL</code> environment variables.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="running-them-in-the-ci-pipeline">Running them in the CI pipeline<a class="hash-link" href="#running-them-in-the-ci-pipeline" title="Direct link to heading">​</a></h3><p>All integration tests should go into the <a href="/edc-docs/.github/workflows/verify.yaml">verify workflow</a>, every
&quot;technology&quot; should have its own job, and technology specific tests can be targeted using Junit tags with
<code>-DincludeTags</code> property as described above in document.</p><p>A GitHub <a href="https://docs.github.com/actions/creating-actions/creating-a-composite-action" target="_blank" rel="noopener noreferrer">composite action</a> was created to
encapsulate the tasks of running tests and uploading test reports as artifacts for publication.</p><p>A final job named  <code>Upload-Test-Report</code>  should depend on all test jobs. It assembles all individual test reports.</p><p>For example let&#x27;s assume we&#x27;ve implemented a Postgres-based Asset Index, then the integration tests for that should go
into a &quot;Postgres&quot; <code>job</code>, and every module that adds a test (here: <code>extensions:postgres:assetindex</code>) should apply a
composite annotation (here: <code>@PostgresIntegrationTest</code> adding a tag <code>PostgresIntegrationTest</code>) on its integration tests.
This tagging will be used by the CI pipeline step to target and execute the integration tests related to Postgres.</p><p>Let&#x27;s also make sure that the code is checked out before and integration tests only run on the upstream repo.</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">jobs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">Postgres-Integration-Tests</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># run only on upstream repo</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">if</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> github.repository_owner == &#x27;eclipse</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">edc&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">runs-on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ubuntu</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># taken from https://docs.github.com/en/actions/using-containerized-services/creating-postgresql-service-containers</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">services</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># Label used to access the service container</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">postgres</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Docker Hub image</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> postgres</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Provide the password for postgres</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">env</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">POSTGRES_PASSWORD</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> secrets.POSTGRES_PASSWORD </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Set health checks to wait until postgres has started</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">options</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">health</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">cmd pg_isready</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">health</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">interval 10s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">health</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">timeout 5s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">health</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">retries 5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">env</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">POSTGRES_USER</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> secrets.POSTGRES_USERNAME </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">POSTGRES_PWD</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> secrets.POSTGRES_PASSWORD </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">steps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ./.github/actions/setup</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Postgres Tests   </span><span class="token comment" style="color:#999988;font-style:italic">#just an example!</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ./.github/actions/run</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">tests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">with</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ./gradlew </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">p extensions/postgres test </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">DincludeTags=&quot;PostgresIntegrationTest&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">Upload-Test-Report</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">needs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> Postgres</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Integration</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Tests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>It is important to note that the secrets (here: <code>POSTGRES_USERNAME</code> and <code>POSTGRES_PASSWORD</code>) must be defined within the
repository&#x27;s settings and that can only be done by a committer with temporary admin access, so be sure to contact them
before submitting your PR.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="dos-and-donts">Do&#x27;s and Don&#x27;ts<a class="hash-link" href="#dos-and-donts" title="Direct link to heading">​</a></h3><p>DO:</p><ul><li>use integration tests sparingly and only when unit tests are not practical</li><li>deploy the external system as <code>service</code> directly in the workflow or</li><li>use a dedicated always-on test instance</li><li>take into account that external systems might experience transient failures or have degraded performance, so test
methods should have a timeout so as not to block the runner indefinitely.</li><li>use randomized strings for things like database/table/bucket/container names, etc., especially when the external
system does not get destroyed after the test.</li></ul><p>DO NOT:</p><ul><li>try to cover everything with integration tests. It&#x27;s typically a code smell if there are no corresponding unit tests
for an integration test.</li><li>slip into a habit of testing the external system rather than your usage of it</li><li>store secrets directly in the code. Github will warn about that.</li><li>perform complex external system setup in <code>@BeforeEach</code> or <code>@BeforeAll</code></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="system-tests">System tests<a class="hash-link" href="#system-tests" title="Direct link to heading">​</a></h2><p>System tests are needed when an entire feature should be tested, end to end.</p><p>To write a system test two parts are needed:</p><ul><li><em>runner</em>: a module that contains the test logic</li><li><em>runtimes</em>: one or more modules that define a standalone runtime (e.g. a complete EDC definition)</li></ul><p>The runner can load an EDC runtime by using the <code>@RegisterExtension</code> annotation (example
in <a target="_blank" href="/edc-docs/assets/files/FileTransferIntegrationTest-511a3648e8559c582836402eb327c494.java"><code>FileTransferIntegrationTest</code></a>)
.</p><p>To make sure that the runtime extensions are correctly built and available, they need to be set as dependency of the
runner module as <code>testCompileOnly</code>. (example in <a href="/edc-docs/system-tests/tests/build.gradle.kts"><code>build.gradle.kts</code></a>).</p><p>This would permit the dependency isolation between runtimes (very important the test need to run two different
components like a control plane and a data plane).</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="performance-tests">Performance tests<a class="hash-link" href="#performance-tests" title="Direct link to heading">​</a></h2><p>To evaluate performance of the system such tests can be added. Each performance tests should be tagged with
<code>@PerformanceTest</code> annotation. To maintain historic data about system performance these tests are executed nightly via
github workflow <code>performancetests.yml</code>, test reports are uploaded as an github artifact at end of workflow run.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/FraunhoferISST/edc-docs/tree/master/docs/submodule/Connector/docs/developer/testing.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#adding-edc-test-fixtures" class="table-of-contents__link toc-highlight">Adding EDC test fixtures</a></li><li><a href="#controlling-test-verbosity" class="table-of-contents__link toc-highlight">Controlling test verbosity</a></li><li><a href="#definition-and-distinction" class="table-of-contents__link toc-highlight">Definition and distinction</a></li><li><a href="#integration-tests" class="table-of-contents__link toc-highlight">Integration Tests</a><ul><li><a href="#tldr" class="table-of-contents__link toc-highlight">TL;DR</a></li><li><a href="#when-to-use-them" class="table-of-contents__link toc-highlight">When to use them</a></li><li><a href="#coding-guidelines" class="table-of-contents__link toc-highlight">Coding Guidelines</a></li><li><a href="#running-them-locally" class="table-of-contents__link toc-highlight">Running them locally</a></li><li><a href="#running-them-in-the-ci-pipeline" class="table-of-contents__link toc-highlight">Running them in the CI pipeline</a></li><li><a href="#dos-and-donts" class="table-of-contents__link toc-highlight">Do&#39;s and Don&#39;ts</a></li></ul></li><li><a href="#system-tests" class="table-of-contents__link toc-highlight">System tests</a></li><li><a href="#performance-tests" class="table-of-contents__link toc-highlight">Performance tests</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 My Project,  built with Fraunhofer ISST.</div></div></div></footer></div>
<script src="/edc-docs/assets/js/runtime~main.bbc09bb1.js"></script>
<script src="/edc-docs/assets/js/main.bdd0bebb.js"></script>
</body>
</html>