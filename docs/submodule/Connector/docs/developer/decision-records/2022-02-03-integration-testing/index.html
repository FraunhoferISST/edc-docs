<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-submodule/Connector/docs/developer/decision-records/2022-02-03-integration-testing/README">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">Integration testing | My Site</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://FraunhoferISST.github.io/edc-docs/docs/submodule/Connector/docs/developer/decision-records/2022-02-03-integration-testing/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Integration testing | My Site"><meta data-rh="true" name="description" content="Decision"><meta data-rh="true" property="og:description" content="Decision"><link data-rh="true" rel="icon" href="/edc-docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://FraunhoferISST.github.io/edc-docs/docs/submodule/Connector/docs/developer/decision-records/2022-02-03-integration-testing/"><link data-rh="true" rel="alternate" href="https://FraunhoferISST.github.io/edc-docs/docs/submodule/Connector/docs/developer/decision-records/2022-02-03-integration-testing/" hreflang="en"><link data-rh="true" rel="alternate" href="https://FraunhoferISST.github.io/edc-docs/docs/submodule/Connector/docs/developer/decision-records/2022-02-03-integration-testing/" hreflang="x-default"><link rel="stylesheet" href="/edc-docs/assets/css/styles.5bd81ef5.css">
<link rel="preload" href="/edc-docs/assets/js/runtime~main.bbc09bb1.js" as="script">
<link rel="preload" href="/edc-docs/assets/js/main.bdd0bebb.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/edc-docs/"><div class="navbar__logo"><img src="/edc-docs/img/icon.png" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/edc-docs/img/icon.png" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a><a class="navbar__item navbar__link" href="/edc-docs/docs/">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/eclipse-dataspacecomponents/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><main class="docMainContainer_gTbr docMainContainerEnhanced_Uz_u"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Integration testing</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="decision">Decision<a class="hash-link" href="#decision" title="Direct link to heading">​</a></h2><p>Extend the existing <code>EdcExtension</code> JUnit facility (that can currently run a single EDC runtime and supports stubbing and extension of runtime services) as follows:</p><ul><li>Load more than one EDC runtime.</li><li>Load EDC runtimes in separate Class Loaders.</li><li>Run each EDC runtime Class Loader with its effective runtime class path, based on its module&#x27;s Gradle configuration.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="rationale">Rationale<a class="hash-link" href="#rationale" title="Direct link to heading">​</a></h2><p>The need to provide an integration test harness that supports multiple runtimes emerges from multiple needs:</p><ul><li>Stabilizing <a href="/edc-docs/samples">samples</a> that run multiple connectors, which have been breaking frequently.</li><li>Testing system behavior when multiple connectors interact, e.g. the contract negotiation process.</li><li>Testing system behavior upon component failure.</li><li>Providing a test facility for factoring out application components to separate runtimes (e.g. <a href="https://github.com/eclipse-edc/Connector/issues/463" target="_blank" rel="noopener noreferrer">DPF</a>).</li></ul><p>Key drivers for the choice are:</p><ul><li>Fast and efficient run in CI.</li><li>Fast &quot;inner loop&quot; (i.e. ability to quickly rerun tests after changing code) and debuggability for developers.</li><li>Use of existing frameworks, stability and portability.</li></ul><p>We have performed technical spikes testing multiple approaches (detailed further below), including various combinations of:</p><ul><li>JUnit</li><li><a href="https://docs.docker.com/compose/" target="_blank" rel="noopener noreferrer">Docker compose</a></li><li>Starting custom Class Loaders for separate threads for the Provider and Connector with separate class paths. Using distinct Class Loaders (and threads) for each service effectively provides full runtime isolation within a single JVM</li><li><a href="https://www.testcontainers.org/" target="_blank" rel="noopener noreferrer">Testcontainers</a> with custom containers was also evaluated, but support for bidirectional communication to host is complex, and we didn&#x27;t manage to get it running.</li></ul><p>Spinning additional Class Loaders for runtimes with JUnit provides very fast inner loop. Using the Gradle Classpath is <a href="https://en.wikipedia.org/wiki/Don%27t_repeat_yourself" target="_blank" rel="noopener noreferrer">DRY</a> and ensures the runtime under test exactly matches the standalone one.</p><p>In contrast, approaches based on Docker have a slow inner loop and require rebuild between runs.</p><p>The approach used is not limited to the Dataspace Connector, it can be used to run any Java module if required in the future.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="spikes">Spikes<a class="hash-link" href="#spikes" title="Direct link to heading">​</a></h2><p>We have performed technical spikes on <a href="/edc-docs/samples/04.0-file-transfer/README.md">sample 04.0-file-transfer</a>, that runs two EDC connectors, a Consumer and a Provider. <a href="https://github.com/agera-edc/DataSpaceConnector/pull/3/files" target="_blank" rel="noopener noreferrer">Spike code is in a forked repository</a>. The test requires three components:</p><ul><li>Consumer EDC connector</li><li>Provider EDC connector</li><li>HTTP client code to interact with the Consumer provider API</li></ul><p>We have written code for the following three options:</p><ul><li><strong>Docker-compose</strong> which works but provides an inconvenient inner loop.</li><li><strong>Class Loader with Gradle Classpath</strong>, which uses Gradle to determine the effective class path for each runtime, and is very efficient. It is therefore the base for the recommendation above.</li><li><strong>Class Loader with Shadow JAR</strong>, a variant of the above which uses the Shadow JAR, and provides a less efficient inner loop.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="docker-compose">Docker-compose<a class="hash-link" href="#docker-compose" title="Direct link to heading">​</a></h3><p>In this setup, we run both connectors in Docker containers. Once they are up, we run HTTP client code in a JUnit test running on the host.</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># docker-compose.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">services</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">sample04-connector-provider</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">build</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">context</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">target</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sample04</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">connector</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">provider</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;8181:8181&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /tmp/provider</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/tmp/provider</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /tmp/consumer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/tmp/consumer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">sample04-connector-consumer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">build</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">context</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">target</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sample04</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">connector</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">consumer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;9191:9191&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /tmp/provider</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/tmp/provider</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /tmp/consumer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/tmp/consumer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cd samples/04.0-file-transfer </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">docker-compose</span><span class="token plain"> up -d</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Successfully built 26b639e8f852</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Successfully tagged 040-file-transfer_sample04-connector-consumer:latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">+</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Running </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">/3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ⠿ Network 040-file-transfer_default      Created                                                                                                                                </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">.0s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ⠿ Container sample04-connector-provider  Started                                                                                                                                </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">.7s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ⠿ Container sample04-connector-consumer  Started                                                                                                                                </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">.6s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token assign-left variable" style="color:#36acaa">RUN_INTEGRATION_TEST</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true </span><span class="token assign-left variable" style="color:#36acaa">EDC_PROVIDER_CONNECTOR_HOST</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">http://sample04-connector-provider:8181 </span><span class="token function" style="color:#d73a49">time</span><span class="token plain"> ./gradlew cleanTest :samples:04.0-file-transfer:integration-tests:test --tests org.eclipse.dataspaceconnector.samples.FileTransferSystemTest</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This setup is stable and straightforward and also resembles a real deployment scenario in which provider and consumer connectors are running as a separate independent java process, but the inner loop is not very efficient for local development as to reload every new code change connector jars needs to rebuild and restart docker process to use latest jars. Debugging a remote process is possible but adds complexity.</p><p>For faster local development/debugging one efficient approach could be to run connectors code in debug mode within IDE and necessary IDE run configurations can be provided as xml config files. These run configurations also can be committed in the repository to reduce local development environment setup effort.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="class-loader-with-gradle-classpath">Class Loader with Gradle Classpath<a class="hash-link" href="#class-loader-with-gradle-classpath" title="Direct link to heading">​</a></h3><p>The integration tests module only contains the classpath of the Provider module:</p><div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    implementation(project(&quot;:samples:04.0-file-transfer:provider&quot;))</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The JUnit integration test runs the Provider using the preexisting <code>EdcExtension</code>, and the Consumer using a newly developed extension:</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// EDC Consumer runtime</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@RegisterExtension</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static EdcRuntimeExtension consumer = new EdcRuntimeExtension(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;:samples:04.0-file-transfer:consumer&quot;, // Gradle module of the runtime to be started</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;consumer&quot;, // prefix for console log output</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Map.of( // settings</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;web.http.port&quot;, String.valueOf(CONSUMER_CONNECTOR_PORT),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;edc.api.control.auth.apikey.value&quot;, API_KEY_CONTROL_AUTH,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;ids.webhook.address&quot;, CONSUMER_CONNECTOR_HOST));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// EDC Provider runtime</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@RegisterExtension</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static EdcRuntimeExtension provider = new EdcRuntimeExtension(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;:samples:04.0-file-transfer:provider&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;provider&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Map.of(...));</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The extension determines the class path by running a custom Gradle task:</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// EdcRuntimeExtension.java</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Runtime.getRuntime().exec(&quot;/gradlew -q &quot; + moduleName + &quot;:printClasspath&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// ... process classpath (see below) ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// run a thread with a custom class loader</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var classLoader = URLClassLoader.newInstance(classPathEntries,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                             ClassLoader.getSystemClassLoader());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var mainClassName = BaseRuntime.class.getCanonicalName();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var mainClass = classLoader.loadClass(mainClassName);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var mainMethod = mainClass.getMethod(&quot;main&quot;, String[].class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">runtimeThread = new Thread(() -&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                           {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                             Thread.currentThread().setContextClassLoader(classLoader);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                             mainMethod.invoke(null, new Object[]{new String[0]});</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                           })</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">     // build.gradle.kts (under allprojects)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     tasks.register(&quot;printClasspath&quot;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     doLast {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        println(&quot;${sourceSets[&quot;main&quot;].runtimeClasspath.asPath}&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The Gradle classpath is composed of JARs within the Connector project (e.g. <code>/path/to/EclipseDataSpaceConnector/extensions/api/control/build/libs/control-0.0.1-SNAPSHOT.jar</code>) and JARs from the Gradle cache (e.g. <code>/home/user/.gradle/caches/modules-2/files-2.1/org.eclipse.jetty/jetty-util/11.0.6/292fa5d7b2cef3483da8a7fa9dd608bfc9896564/jetty-util-11.0.6.jar</code>). The Extension code replaces JAR entries of Connector modules with their compiled classes and resource directories (<code>build/classes/java/main/</code> and <code>build/resources/main/</code>), and loads the connector within a separate Class Loader.</p><p>Setting up the Test task to pass standard output:</p><div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// samples/04.0-file-transfer/integration-tests/build.gradle.kts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tasks.getByName&lt;Test&gt;(&quot;test&quot;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    testLogging {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        showStandardStreams = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The test runs in seconds.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">time</span><span class="token plain"> ./gradlew cleanTest :samples:04.0-file-transfer:integration-tests:test --tests org.eclipse.dataspaceconnector.samples.ClassLoaderWithGradleClasspathTest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> Configure project </span><span class="token builtin class-name">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> No version was specified, setting default </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">.1-SNAPSHOT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> If you want to change this, supply the -Pversion</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">X.Y.Z parameter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> Task :samples:04.0-file-transfer:integration-tests:test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ClassLoaderWithGradleClasspathTest STANDARD_OUT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    INFO </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-03T17:19:42.201218 Configuration </span><span class="token function" style="color:#d73a49">file</span><span class="token plain"> does not exist: dataspaceconnector-configuration.properties. Ignoring.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    INFO </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-03T17:19:42.21943 Initialized FS Configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    INFO </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-03T17:19:42.228993 Secrets vault not configured. Defaulting to null vault.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    INFO </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-03T17:19:42.229459 Initialized Null Vault</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    INFO </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-03T17:19:42.469222 Initialized Core Services</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    INFO </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-03T17:19:42.470778 Initialized In-Memory Asset Index</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    INFO </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-03T17:19:42.472156 Initialized In-Memory Contract Definition Store</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    INFO </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-03T17:19:42.480915 Initialized Core Contract Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    INFO </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-03T17:19:42.481961 Initialized In-Memory Transfer Process Store</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    INFO </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-03T17:19:42.483762 Initialized org.eclipse.dataspaceconnector.transfer.core.CommandExtension</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    INFO </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-03T17:19:42.489996 Initialized Core Transfer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    INFO </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-03T17:19:42.490808 Initialized Mock IAM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    INFO </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-03T17:19:42.673829 HTTP listening on </span><span class="token number" style="color:#36acaa">9191</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    INFO </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-03T17:19:42.76275 Started Jetty Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    INFO </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-03T17:19:43.228771 Registered Web API context at: /api/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    INFO </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-03T17:19:43.229002 Started Jersey Web Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    INFO </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-03T17:19:43.229442 Started IDS Multipart API</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    INFO </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-03T17:19:43.22957 Started org.eclipse.dataspaceconnector.extensions.api.FileTransferExtension</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    INFO </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-03T17:19:43.229659 Started IDS Multipart Dispatcher API</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    INFO </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-03T17:19:43.229751 Started IDS Transform Extension</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    INFO </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-03T17:19:43.229837 Started EDC Control API</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    INFO </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-03T17:19:43.229915 Started API Endpoint</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    INFO </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-03T17:19:43.230525 edc-ce5e1eb0-62ea-43d0-858a-e48118e97d85 ready</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ClassLoaderWithGradleClasspathTest </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> transferFile_success</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> STANDARD_OUT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    INFO </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-03T17:19:43.666544 Configuration </span><span class="token function" style="color:#d73a49">file</span><span class="token plain"> does not exist: dataspaceconnector-configuration.properties. Ignoring.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    INFO </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-03T17:19:43.666879 Initialized FS Configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    INFO </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-03T17:19:43.667783 Secrets vault not configured. Defaulting to null vault.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    INFO </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-03T17:19:43.667928 Initialized Null Vault</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    INFO </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-03T17:19:43.677249 Initialized Core Services</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    INFO </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-03T17:19:43.677423 Initialized In-Memory Asset Index</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    INFO </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-03T17:19:43.677543 Initialized In-Memory Contract Definition Store</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    INFO </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-03T17:19:43.677745 Initialized Core Contract Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    INFO </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-03T17:19:43.677868 Initialized In-Memory Transfer Process Store</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    INFO </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-03T17:19:43.677988 Initialized org.eclipse.dataspaceconnector.transfer.core.CommandExtension</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    INFO </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-03T17:19:43.678098 Initialized Core Transfer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    INFO </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-03T17:19:43.678255 Initialized Mock IAM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    INFO </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-03T17:19:43.685601 Started In-Memory Contract Negotiation Store</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    INFO </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-03T17:19:43.686003 HTTP listening on </span><span class="token number" style="color:#36acaa">8181</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    INFO </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-03T17:19:43.689505 Started Jetty Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ClassLoaderWithGradleClasspathTest </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> transferFile_success</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> STANDARD_OUT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    INFO </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-03T17:19:43.736455 Registered Web API context at: /api/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    INFO </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-03T17:19:43.736607 Started Jersey Web Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    INFO </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-03T17:19:43.736657 Started IDS Multipart API</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    INFO </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-03T17:19:43.736695 Started org.eclipse.dataspaceconnector.extensions.api.FileTransferExtension</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    INFO </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-03T17:19:43.736754 Started IDS Multipart Dispatcher API</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    INFO </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-03T17:19:43.73684 Started IDS Transform Extension</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    DEBUG </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-03T17:19:48.434665 </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Consumer</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> ContractNegotiation initiated. aa9a36be-af41-4da4-b198-711389690558 is now </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> state INITIAL.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    DEBUG </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-03T17:19:52.85985 </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Provider</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> ContractNegotiation initiated. f8b7bb63-cdb3-4c17-8969-aaa0b868d5b3 is now </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> state REQUESTED.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    DEBUG </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-03T17:19:52.864953 </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Provider</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Contract offer received. Will be approved.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    DEBUG </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-03T17:19:52.865395 </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Provider</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> ContractNegotiation f8b7bb63-cdb3-4c17-8969-aaa0b868d5b3 is now </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> state CONFIRMING.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    DEBUG </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-03T17:19:52.876959 Response received from connector. Status </span><span class="token number" style="color:#36acaa">200</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    DEBUG </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-03T17:19:52.889059 </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Consumer</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> ContractNegotiation aa9a36be-af41-4da4-b198-711389690558 is now </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> state REQUESTED.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    DEBUG </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-03T17:19:53.743579 </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Consumer</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Contract agreement received. Validation successful.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    DEBUG </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-03T17:19:53.744268 </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Consumer</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> ContractNegotiation aa9a36be-af41-4da4-b198-711389690558 is now </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> state CONFIRMED.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    DEBUG </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-03T17:19:53.748143 Response received from connector. Status </span><span class="token number" style="color:#36acaa">200</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    DEBUG </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-03T17:19:53.754331 </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Provider</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> ContractNegotiation f8b7bb63-cdb3-4c17-8969-aaa0b868d5b3 is now </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> state CONFIRMED.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    INFO </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-03T17:19:53.831271 Received request </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">file</span><span class="token plain"> test-document against provider http://localhost:8181/api/v1/ids/data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    DEBUG </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-03T17:19:57.647989 Response received from connector. Status </span><span class="token number" style="color:#36acaa">200</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    INFO </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-03T17:19:57.650468 Object received: org.eclipse.dataspaceconnector.ids.api.multipart.dispatcher.message.MultipartRequestInProcessResponse@4eeb3196</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    INFO </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-03T17:19:58.687893 Copying data from File to File</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    INFO </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-03T17:19:58.690052 Successfully copied </span><span class="token function" style="color:#d73a49">file</span><span class="token plain"> to /tmp/consumer/test-document.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    DEBUG </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-03T17:20:02.640684 Process 60e34667-c51b-4a38-bb08-ddd4d705c234 is now COMPLETED</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    INFO </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-02-03T17:20:02.68389 Connector </span><span class="token function" style="color:#d73a49">shutdown</span><span class="token plain"> complete</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">BUILD SUCCESSFUL </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> 33s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">240</span><span class="token plain"> actionable tasks: </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> executed, </span><span class="token number" style="color:#36acaa">238</span><span class="token plain"> up-to-date</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">1</span><span class="token plain">.89user </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">.11system </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">:34.37elapsed </span><span class="token number" style="color:#36acaa">5</span><span class="token plain">%CPU</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Running in an IDE (IntelliJ IDEA), the debugger can be used in both Provider and Consumer code. When a class source is modified and the test is rerun, the change is immediately reflected.</p><p>We could have run the equivalent setup inverting the Provider and Consumer in the two extensions we used. In this infrastructure, only one of the connectors can use the <code>EdcExtension</code> facilities to add or mock services. This exploratory spike code was built as a quick-and-dirty PoC. When adapting this spike code for merging, we should improve this setup, by extending the <code>EdcExtension</code> to provide both classpath isolation and test runtime configurability.</p><p>Note that this setup requires the modules to have previously been built (<code>./gradlew build</code>).</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="class-loader-with-shadow-jar">Class Loader with Shadow JAR<a class="hash-link" href="#class-loader-with-shadow-jar" title="Direct link to heading">​</a></h3><p>The setup is very similar to the above, but the Shadow JAR of the connector is run:</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    // EDC Consumer runtime</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @RegisterExtension</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Order(1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    static JarRuntimeExtension otherConnector = new JarRuntimeExtension(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;../consumer/build/libs/consumer.jar&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Map.of(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &quot;web.http.port&quot;, &quot;9191&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &quot;edc.api.control.auth.apikey.value&quot;, API_KEY_CONTROL_AUTH,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &quot;ids.webhook.address&quot;, &quot;http://localhost:9191&quot;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // EDC Provider runtime</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @RegisterExtension</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Order(2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    static EdcExtension edc = new EdcExtension();</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// JarRuntimeExtension</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var classLoader = URLClassLoader.newInstance(new URL[]{jarFile.toURI().toURL()},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        ClassLoader.getSystemClassLoader());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Thread.currentThread().setContextClassLoader(classLoader);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var mainClass = classLoader.loadClass(mainClassName);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var mainMethod = mainClass.getMethod(&quot;main&quot;, String[].class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mainMethod.invoke(null, new Object[]{new String[0]});</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The setup is slightly simpler than the previous one, but the inner loop is less efficient: the Gradle <code>shadowJar</code> task must be rerun between test runs.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/FraunhoferISST/edc-docs/tree/master/docs/submodule/Connector/docs/developer/decision-records/2022-02-03-integration-testing/README.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#decision" class="table-of-contents__link toc-highlight">Decision</a></li><li><a href="#rationale" class="table-of-contents__link toc-highlight">Rationale</a></li><li><a href="#spikes" class="table-of-contents__link toc-highlight">Spikes</a><ul><li><a href="#docker-compose" class="table-of-contents__link toc-highlight">Docker-compose</a></li><li><a href="#class-loader-with-gradle-classpath" class="table-of-contents__link toc-highlight">Class Loader with Gradle Classpath</a></li><li><a href="#class-loader-with-shadow-jar" class="table-of-contents__link toc-highlight">Class Loader with Shadow JAR</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 My Project,  built with Fraunhofer ISST.</div></div></div></footer></div>
<script src="/edc-docs/assets/js/runtime~main.bbc09bb1.js"></script>
<script src="/edc-docs/assets/js/main.bdd0bebb.js"></script>
</body>
</html>