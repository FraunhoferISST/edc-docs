"use strict";(self.webpackChunkedc_docs=self.webpackChunkedc_docs||[]).push([[7408],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var r=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var c=r.createContext({}),l=function(e){var t=r.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=l(e.components);return r.createElement(c.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},u=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,c=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),u=l(n),m=a,g=u["".concat(c,".").concat(m)]||u[m]||d[m]||o;return n?r.createElement(g,i(i({ref:t},p),{},{components:n})):r.createElement(g,i({ref:t},p))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=u;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var l=2;l<o;l++)i[l]=n[l];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}u.displayName="MDXCreateElement"},80175:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>s,toc:()=>l});var r=n(87462),a=(n(67294),n(3905));const o={},i="Tracing",s={unversionedId:"submodule/Connector/docs/developer/decision-records/2022-02-07-tracing/README",id:"submodule/Connector/docs/developer/decision-records/2022-02-07-tracing/README",title:"Tracing",description:"Decision",source:"@site/docs/submodule/Connector/docs/developer/decision-records/2022-02-07-tracing/README.md",sourceDirName:"submodule/Connector/docs/developer/decision-records/2022-02-07-tracing",slug:"/submodule/Connector/docs/developer/decision-records/2022-02-07-tracing/",permalink:"/edc-docs/docs/submodule/Connector/docs/developer/decision-records/2022-02-07-tracing/",draft:!1,editUrl:"https://github.com/FraunhoferISST/edc-docs/tree/master/docs/submodule/Connector/docs/developer/decision-records/2022-02-07-tracing/README.md",tags:[],version:"current",frontMatter:{}},c={},l=[{value:"Decision",id:"decision",level:2},{value:"Rationale",id:"rationale",level:2},{value:"Custom Spans",id:"custom-spans",level:2},{value:"Span naming",id:"span-naming",level:3},{value:"Sample traces with Jaeger",id:"sample-traces-with-jaeger",level:2},{value:"Contract Negotiation Trace",id:"contract-negotiation-trace",level:3},{value:"Transfer Process Trace",id:"transfer-process-trace",level:3}],p={toc:l};function d(e){let{components:t,...o}=e;return(0,a.kt)("wrapper",(0,r.Z)({},p,o,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"tracing"},"Tracing"),(0,a.kt)("h2",{id:"decision"},"Decision"),(0,a.kt)("p",null,"Use ",(0,a.kt)("a",{parentName:"p",href:"https://opentelemetry.io/"},"OpenTelemetry")," to enable distributed tracing in EDC. "),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://opentelemetry.io/docs/instrumentation/java/manual/#context-propagation"},"Context propagation")," needs to be implemented accordingly so that traces are propagated across asynchronous workers. Business entities processed by async workers are used as carriers of tracing information, which is persisted together with the rest of the entity."),(0,a.kt)("h2",{id:"rationale"},"Rationale"),(0,a.kt)("p",null,"Distributed tracing is an essential observability pillar to correlate requests as they propagate through distributed cloud environments and services. EDC as a framework needs to support distributed tracing in any possible constellation where it might come to use. "),(0,a.kt)("p",null,"OpenTelemetry provides a vendor-agnostic solution that can be configured to send telemetry data to the backend(s) of choice, including a variety of popular open-source projects. OpenTelemetry instrumentation with Java uses a Java agent that dynamically injects bytecode to capture telemetry from many popular libraries and frameworks automatically. It can be used to capture telemetry data at the \u201cedges\u201d of an app or service, such as inbound requests, outbound HTTP calls, database calls, and so on. This makes it a very compelling option for EDC. "),(0,a.kt)("h2",{id:"custom-spans"},"Custom Spans"),(0,a.kt)("p",null,"In addition to the spans created by OpenTelemetry's ",(0,a.kt)("a",{parentName:"p",href:"https://opentelemetry.io/docs/instrumentation/java/automatic/"},"automatic instrumentation"),", additional custom spans have been created using the ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/open-telemetry/opentelemetry-java-instrumentation/blob/main/docs/manual-instrumentation.md#creating-spans-around-methods-with-withspan"},"WithSpan")," annotation in several parts of the EDC codebase."),(0,a.kt)("p",null,"The general rule of the thumb is to create additional custom spans for operations relevant for tracing, normally involving some kind of I/O and/or communication between components, plus additional core operations that need to be tracked. For EDC we recommend creating custom spans for the following operations:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Consumer-provider connector communication (methods called by REST handlers)"),(0,a.kt)("li",{parentName:"ul"},"State handling methods (methods called by the ContractNegotiation and TransferProcess state machine)"),(0,a.kt)("li",{parentName:"ul"},"Resource provisioning and deprovisioning"),(0,a.kt)("li",{parentName:"ul"},"TransferProcess data flows"),(0,a.kt)("li",{parentName:"ul"},"Database operations")),(0,a.kt)("h3",{id:"span-naming"},"Span naming"),(0,a.kt)("p",null,"Although custom spans can be given a specific name, we suggest using default span names to avoid duplication. Good method naming will automatically lead to good span naming as this will be used as default, together with the class name (e.g. ",(0,a.kt)("inlineCode",{parentName:"p"},"ProvisionManagerImpl.provision"),")"),(0,a.kt)("h2",{id:"sample-traces-with-jaeger"},"Sample traces with Jaeger"),(0,a.kt)("p",null,"The following two samples were created by running the scenario presented in ",(0,a.kt)("a",{parentName:"p",href:"/samples/04.3-open-telemetry"},"sample 04.3")," using the Jaeger backend. Note how traces include communication between consumer and provider due to a proper trace context propagation."),(0,a.kt)("h3",{id:"contract-negotiation-trace"},"Contract Negotiation Trace"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Contract Negotiation",src:n(43157).Z,width:"2348",height:"666"})),(0,a.kt)("h3",{id:"transfer-process-trace"},"Transfer Process Trace"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Transfer Process",src:n(46305).Z,width:"3838",height:"1504"})))}d.isMDXComponent=!0},43157:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/contract_negotiation-566f341f0868de5ae4d5eee9f70ba713.png"},46305:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/transfer_process-4ce6f36c5ec1cbfafca47460c742c374.png"}}]);