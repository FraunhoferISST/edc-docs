"use strict";(self.webpackChunkedc_docs=self.webpackChunkedc_docs||[]).push([[3117],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>d});var i=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,i,a=function(e,t){if(null==e)return{};var n,i,a={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=i.createContext({}),c=function(e){var t=i.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},p=function(e){var t=c(e.components);return i.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},h=i.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),h=c(n),d=a,f=h["".concat(s,".").concat(d)]||h[d]||u[d]||o;return n?i.createElement(f,r(r({ref:t},p),{},{components:n})):i.createElement(f,r({ref:t},p))}));function d(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,r=new Array(o);r[0]=h;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,r[1]=l;for(var c=2;c<o;c++)r[c]=n[c];return i.createElement.apply(null,r)}return i.createElement.apply(null,n)}h.displayName="MDXCreateElement"},75639:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>r,default:()=>u,frontMatter:()=>o,metadata:()=>l,toc:()=>c});var i=n(87462),a=(n(67294),n(3905));const o={},r="Trust Framework Policy Extension",l={unversionedId:"submodule/TrustFrameworkAdoption/extensions/common/trust-framework-policies/README",id:"submodule/TrustFrameworkAdoption/extensions/common/trust-framework-policies/README",title:"Trust Framework Policy Extension",description:"This extension provides a way to register the evaluation functions referenced by the Policies into the Policy Engine. Each evaluation function",source:"@site/docs/submodule/TrustFrameworkAdoption/extensions/common/trust-framework-policies/README.md",sourceDirName:"submodule/TrustFrameworkAdoption/extensions/common/trust-framework-policies",slug:"/submodule/TrustFrameworkAdoption/extensions/common/trust-framework-policies/",permalink:"/edc-docs/docs/submodule/TrustFrameworkAdoption/extensions/common/trust-framework-policies/",draft:!1,editUrl:"https://github.com/FraunhoferISST/edc-docs/tree/master/docs/submodule/TrustFrameworkAdoption/extensions/common/trust-framework-policies/README.md",tags:[],version:"current",frontMatter:{}},s={},c=[{value:"Configuration file",id:"configuration-file",level:2},{value:"Left operand extraction - JsonPath DSL",id:"left-operand-extraction---jsonpath-dsl",level:2},{value:"Limitation",id:"limitation",level:3},{value:"Practical usage of the extension - Example",id:"practical-usage-of-the-extension---example",level:2},{value:"Creation of the evaluation function",id:"creation-of-the-evaluation-function",level:3},{value:"Creation of the policy",id:"creation-of-the-policy",level:3}],p={toc:c};function u(e){let{components:t,...o}=e;return(0,a.kt)("wrapper",(0,i.Z)({},p,o,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"trust-framework-policy-extension"},"Trust Framework Policy Extension"),(0,a.kt)("p",null,"This extension provides a way to register the evaluation functions referenced by the Policies into the Policy Engine. Each evaluation function\nextract the left operand from the set of claims provided in input and whose format is documented in the ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/eclipse-dataspaceconnector/IdentityHub/tree/main/docs/developer/decision-records/2022-07-01-get-claims"},"Identity Hub repository"),"."),(0,a.kt)("p",null,"This left operand is then evaluated against the operator and right operand contained in the Policy associated with the evaluation function. "),(0,a.kt)("h2",{id:"configuration-file"},"Configuration file"),(0,a.kt)("p",null,"The extension loads the evaluation functions from a static ",(0,a.kt)("inlineCode",{parentName:"p"},".json")," configuration file whose path is defined by a setting parameter.\nIf none is provided,then the ",(0,a.kt)("a",{target:"_blank",href:n(40130).Z},"gaiax-policies-22_10.json")," is used, which contain a list of predefined\nevaluation function enabling to evaluate the claims of a ",(0,a.kt)("a",{parentName:"p",href:"https://gaia-x.gitlab.io/technical-committee/federation-services/data-exchange/dewg/#ontologies-for-data-exchange"},"Gaia-X Participant Self-Description"),"."),(0,a.kt)("p",null,"Each ",(0,a.kt)("a",{target:"_blank",href:n(84786).Z},"entry")," in the configuration file is composed of:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"a ",(0,a.kt)("inlineCode",{parentName:"li"},"type")," which corresponds to the type of the evaluation function, should be the same to the left operand value of the associated Policy (PolicyEngine will retrieve the\nevaluation function bound with the policy based on its left operand),"),(0,a.kt)("li",{parentName:"ul"},"a ",(0,a.kt)("inlineCode",{parentName:"li"},"scope")," which defines the policy scope on which the evaluation function applies (",(0,a.kt)("inlineCode",{parentName:"li"},"*"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"contract.cataloging"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"contract.cataloging"),"...),"),(0,a.kt)("li",{parentName:"ul"},"a ",(0,a.kt)("inlineCode",{parentName:"li"},"jsonPath")," which defines the path for navigating into the claims and extracting the left value for the evaluation.")),(0,a.kt)("h2",{id:"left-operand-extraction---jsonpath-dsl"},"Left operand extraction - JsonPath DSL"),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"jsonPath")," field defined for each evaluation function in the configuration file follows the ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/json-path/JsonPath"},"Jayway JsonPath DSL"),",\nwhich provides a fluent API for navigating into the claims."),(0,a.kt)("h3",{id:"limitation"},"Limitation"),(0,a.kt)("p",null,"Current implementation only supports string field for the claims and a ",(0,a.kt)("inlineCode",{parentName:"p"},"ClassCastException")," will be thrown if the provided ",(0,a.kt)("inlineCode",{parentName:"p"},"jsonPath")," leads\nto a field whose value is different from a string."),(0,a.kt)("h2",{id:"practical-usage-of-the-extension---example"},"Practical usage of the extension - Example"),(0,a.kt)("p",null,"Let us assume that we are a data provider in a datapace. Some of the data we want to expose to other participants might be publicly accessible,\n",(0,a.kt)("em",{parentName:"p"},"i.e.")," opened to every other dataspace participants, while others\nshould be restricted to a subset of the actual dataspace partcipants. "),(0,a.kt)("p",null,"Here let us assume that we want to restrict access to a specific asset (which can for example be a backend REST API which is serving sensible data)\nto other participants whose datacenters are based in EU. "),(0,a.kt)("p",null,"Putting in place such access control rule involves two steps:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Creating an evaluation function which defines how to navigate into the other participant Verifiable Credential (VC)\nstructure in order to extract the actual ",(0,a.kt)("inlineCode",{parentName:"li"},"region")," in which the datacenter is located. This is what the current extension enables to do."),(0,a.kt)("li",{parentName:"ul"},"Creating a ",(0,a.kt)("inlineCode",{parentName:"li"},"PolicyDefinition")," linked with the previous evaluation function which defines the range of allowed values for\nthe datacenter location in order to be able to access the data. The creation/update/deletion of the ",(0,a.kt)("inlineCode",{parentName:"li"},"PolicyDefinition")," can be done\nthrough the existing Data Management API of the connector.")),(0,a.kt)("h3",{id:"creation-of-the-evaluation-function"},"Creation of the evaluation function"),(0,a.kt)("p",null,"Let's take that the Verifiable Credential giving the datacenter location has the following form: "),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "vc": {\n    "id": "<verifiable-credential-id>",\n    "credentialSubject": {\n      "dataCenterLocation": {\n        "region": "EU",\n        "country": "DE"\n      }\n    }\n  }\n  "iss": "<issuer did>, (part of the JWT claims)",\n  "sub": "<subject>, (part of the JWT claims)"\n}\n')),(0,a.kt)("p",null,"The JSON path for navigating to the actual data center region can be expressed with the ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/json-path/JsonPath"},"Jayway JsonPath DSL"),"\nthrough ",(0,a.kt)("inlineCode",{parentName:"p"},"$.dataCenterLocation.region"),". This is what we have to put in the static JSON file used by the current extension and\nfrom which the evaluation functions will be loaded. See the Gaia-X ",(0,a.kt)("a",{target:"_blank",href:n(40130).Z},"config file")," for an example of configuration file."),(0,a.kt)("h3",{id:"creation-of-the-policy"},"Creation of the policy"),(0,a.kt)("p",null,"Now that we have an evaluation function enabling to extract the desired value from Verifiable Credential claims, we can now bind a ",(0,a.kt)("inlineCode",{parentName:"p"},"PolicyDefinition"),"\nto it, which could like:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n        "createdAt": 1666632333519,\n        "id": "datacenter-region-eu-only",\n        "policy": {\n            "permissions": [\n                {\n                    "edctype": "dataspaceconnector:permission",\n                    "uid": null,\n                    "target": null,\n                    "action": {\n                        "type": "USE",\n                        "includedIn": null,\n                        "constraint": null\n                    },\n                    "assignee": null,\n                    "assigner": null,\n                    "constraints": [\n                        {\n                            "edctype": "AtomicConstraint",\n                            "leftExpression": {\n                                "edctype": "dataspaceconnector:literalexpression",\n                                "value": "dataCenterLocation:region"\n                            },\n                            "rightExpression": {\n                                "edctype": "dataspaceconnector:literalexpression",\n                                "value": "EU"\n                            },\n                            "operator": "EQ"\n                        }\n                    ],\n                    "duties": []\n                }\n            ],\n            "prohibitions": [],\n            "obligations": [],\n            "extensibleProperties": {},\n            "inheritsFrom": null,\n            "assigner": null,\n            "assignee": null,\n            "target": null,\n            "@type": {\n                "@policytype": "set"\n            }\n        }\n    }\n')),(0,a.kt)("p",null,"In order to ensure that the evaluation function is properly associated with the ",(0,a.kt)("inlineCode",{parentName:"p"},"PolicyDefinition"),", you must ensure that the\n",(0,a.kt)("inlineCode",{parentName:"p"},"value")," in the left expression of the constraint is the same as the type specified for the evaluation function in extension configuration file (see previous section).\nThe ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/eclipse-dataspaceconnector/DataSpaceConnector/blob/main/core/common/policy-engine/src/main/java/org/eclipse/edc/policy/engine/PolicyEngineImpl.java"},"Policy Engine"),",\nwill indeed use this left expression for retrieving the evaluation function associated with the policy."),(0,a.kt)("p",null,"This ",(0,a.kt)("inlineCode",{parentName:"p"},"PolicyDefinition")," object can be created at runtime by leveraging the Data Management API exposed by the connector."),(0,a.kt)("p",null,"Finally, we can reference the newly created Policy into the Contract Offer(s) for which we want to put access control in place.\nEDC takes care of the rest!"))}u.isMDXComponent=!0},84786:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/files/PolicyEntry-8b15b1306d252cba62b396e466d20d07.java"},40130:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/files/gaiax-policies-22_10-11828063991e0f4f84fcfec1fda182e9.json"}}]);