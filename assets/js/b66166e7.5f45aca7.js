"use strict";(self.webpackChunkedc_docs=self.webpackChunkedc_docs||[]).push([[1913],{3905:(e,t,n)=>{n.d(t,{Zo:()=>s,kt:()=>m});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var u=a.createContext({}),c=function(e){var t=a.useContext(u),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},s=function(e){var t=c(e.components);return a.createElement(u.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},p=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,u=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),p=c(n),m=r,g=p["".concat(u,".").concat(m)]||p[m]||d[m]||o;return n?a.createElement(g,i(i({ref:t},s),{},{components:n})):a.createElement(g,i({ref:t},s))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=p;var l={};for(var u in t)hasOwnProperty.call(t,u)&&(l[u]=t[u]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var c=2;c<o;c++)i[c]=n[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}p.displayName="MDXCreateElement"},7728:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>l,toc:()=>c});var a=n(7462),r=(n(7294),n(3905));const o={},i=void 0,l={unversionedId:"submodule/DataDashboard/docs/developer/continuous_deployment",id:"submodule/DataDashboard/docs/developer/continuous_deployment",title:"continuous_deployment",description:"Continuous Deployment",source:"@site/docs/submodule/DataDashboard/docs/developer/continuous_deployment.md",sourceDirName:"submodule/DataDashboard/docs/developer",slug:"/submodule/DataDashboard/docs/developer/continuous_deployment",permalink:"/edc-docs/docs/submodule/DataDashboard/docs/developer/continuous_deployment",draft:!1,editUrl:"https://github.com/FraunhoferISST/edc-docs/tree/master/docs/submodule/DataDashboard/docs/developer/continuous_deployment.md",tags:[],version:"current",frontMatter:{}},u={},c=[{value:"Continuous Deployment",id:"continuous-deployment",level:2},{value:"Overview",id:"overview",level:3},{value:"Initializing an Azure environment for CD",id:"initializing-an-azure-environment-for-cd",level:2},{value:"Planning your deployment",id:"planning-your-deployment",level:3},{value:"Create a service identity for GitHub Actions",id:"create-a-service-identity-for-github-actions",level:3},{value:"Configure CD settings",id:"configure-cd-settings",level:3},{value:"Pushing ECD Data Dashboard image manually",id:"pushing-ecd-data-dashboard-image-manually",level:3}],s={toc:c};function d(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},s,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"continuous-deployment"},"Continuous Deployment"),(0,r.kt)("h3",{id:"overview"},"Overview"),(0,r.kt)("p",null,"A GitHub Actions workflow performs continuous build and deployment of the EDC Data Dashboard docker image to an ",(0,r.kt)("a",{parentName:"p",href:"https://docs.microsoft.com/azure/container-registry/container-registry-intro"},"Azure Container Registry"),'. The workflow runs automatically on commits to the "main" branch and uses the git commit id as docker image tag. '),(0,r.kt)("h2",{id:"initializing-an-azure-environment-for-cd"},"Initializing an Azure environment for CD"),(0,r.kt)("h3",{id:"planning-your-deployment"},"Planning your deployment"),(0,r.kt)("p",null,"You will need to provide the following:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"An Azure Container Registry (use preexisting or see ",(0,r.kt)("a",{parentName:"li",href:"https://docs.microsoft.com/azure/container-registry/container-registry-get-started-azure-cli"},"instructions")," how to set up)"),(0,r.kt)("li",{parentName:"ul"},"A service principal (instructions below)")),(0,r.kt)("h3",{id:"create-a-service-identity-for-github-actions"},"Create a service identity for GitHub Actions"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://docs.microsoft.com/azure/active-directory/develop/workload-identity-federation-create-trust-github"},"Create and configure an Azure AD application for GitHub Actions"),"."),(0,r.kt)("p",null,"Follow the instructions to ",(0,r.kt)("em",{parentName:"p"},"Create an app registration"),"."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"In ",(0,r.kt)("strong",{parentName:"li"},"Supported Account Types"),", select ",(0,r.kt)("strong",{parentName:"li"},"Accounts in this organizational directory only"),"."),(0,r.kt)("li",{parentName:"ul"},"Don't enter anything for ",(0,r.kt)("strong",{parentName:"li"},"Redirect URI (optional)"),".")),(0,r.kt)("p",null,"Take note of the Application (client) ID."),(0,r.kt)("p",null,"Follow the instructions to ","[Configure a federated identity credential]","(",(0,r.kt)("a",{parentName:"p",href:"https://docs.microsoft.com/azure/active-directory/develop/workload-identity-federation-create-trust-github?tabs=azure-portal#configure-a-federated-identity-credential"},"Configure a federated identity credential"),") for the ",(0,r.kt)("inlineCode",{parentName:"p"},"main")," branch."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"For ",(0,r.kt)("strong",{parentName:"li"},"Entity Type"),", select ",(0,r.kt)("strong",{parentName:"li"},"Branch"),"."),(0,r.kt)("li",{parentName:"ul"},"For ",(0,r.kt)("strong",{parentName:"li"},"GitHub branch name"),", enter ",(0,r.kt)("inlineCode",{parentName:"li"},"main"),"."),(0,r.kt)("li",{parentName:"ul"},"For ",(0,r.kt)("strong",{parentName:"li"},"Name"),", type any name.")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://docs.microsoft.com/azure/role-based-access-control/role-assignments-portal"},"Grant the application Contributor permissions")," for the corresponding ACR."),(0,r.kt)("p",null,"Configure the following GitHub secrets:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Secret name"),(0,r.kt)("th",{parentName:"tr",align:null},"Value"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ARM_CLIENT_ID")),(0,r.kt)("td",{parentName:"tr",align:null},"The application (client) ID.")))),(0,r.kt)("h3",{id:"configure-cd-settings"},"Configure CD settings"),(0,r.kt)("p",null,"Configure the following GitHub secrets:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Secret name"),(0,r.kt)("th",{parentName:"tr",align:null},"Value"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ARM_TENANT_ID")),(0,r.kt)("td",{parentName:"tr",align:null},"The Azure AD tenant ID.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ARM_SUBSCRIPTION_ID")),(0,r.kt)("td",{parentName:"tr",align:null},"The Azure subscription ID to deploy resources in.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ACR_NAME")),(0,r.kt)("td",{parentName:"tr",align:null},"The name of the Azure Container Registry to use. Should be already deployed.")))),(0,r.kt)("h3",{id:"pushing-ecd-data-dashboard-image-manually"},"Pushing ECD Data Dashboard image manually"),(0,r.kt)("p",null,"You can push the EDC Data Dashboard Docker image to an Azure Container Registry (ACR) of your choice manually."),(0,r.kt)("p",null,"First authenticate with ACR by following the instructions in the ",(0,r.kt)("a",{parentName:"p",href:"https://docs.microsoft.com/azure/container-registry/container-registry-authentication"},"documentation"),". Example for bash:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"az login\naz acr login --name <ACR_NAME>\n")),(0,r.kt)("p",null,"Next, build the docker image by running the following Azure CLI command on your local machine, adapting the name and tag of the image according to your setup:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"docker build -t <ACR_NAME>.azurecr.io/edc/edc-data-dashboard:latest .\n")),(0,r.kt)("p",null,"Finally, push the docker image to ACR:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"docker push <ACR_NAME>.azurecr.io/edc/edc-data-dashboard:latest\n")))}d.isMDXComponent=!0}}]);