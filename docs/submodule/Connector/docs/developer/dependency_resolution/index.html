<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-submodule/Connector/docs/developer/dependency_resolution">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">Dependency resolution in the EDC | My Site</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://FraunhoferISST.github.io/edc-docs/docs/submodule/Connector/docs/developer/dependency_resolution"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Dependency resolution in the EDC | My Site"><meta data-rh="true" name="description" content="The code base of the Eclipse Dataspace Connector is architected in away that allows for easily extending and swapping"><meta data-rh="true" property="og:description" content="The code base of the Eclipse Dataspace Connector is architected in away that allows for easily extending and swapping"><link data-rh="true" rel="icon" href="/edc-docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://FraunhoferISST.github.io/edc-docs/docs/submodule/Connector/docs/developer/dependency_resolution"><link data-rh="true" rel="alternate" href="https://FraunhoferISST.github.io/edc-docs/docs/submodule/Connector/docs/developer/dependency_resolution" hreflang="en"><link data-rh="true" rel="alternate" href="https://FraunhoferISST.github.io/edc-docs/docs/submodule/Connector/docs/developer/dependency_resolution" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/edc-docs/blog/rss.xml" title="My Site RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/edc-docs/blog/atom.xml" title="My Site Atom Feed"><link rel="stylesheet" href="/edc-docs/assets/css/styles.99c6e2a1.css">
<link rel="preload" href="/edc-docs/assets/js/runtime~main.c2e953c9.js" as="script">
<link rel="preload" href="/edc-docs/assets/js/main.ee9e8729.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/edc-docs/"><div class="navbar__logo"><img src="/edc-docs/img/icon.png" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/edc-docs/img/icon.png" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a><a class="navbar__item navbar__link" href="/edc-docs/docs/">Docs</a><a class="navbar__item navbar__link" docid="README" href="/edc-docs/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/eclipse-edc" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://search.maven.org/search?q=g:org.eclipse.edc" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Maven Central<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://app.swaggerhub.com/search?owner=eclipse-edc-bot" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">SwaggerHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><main class="docMainContainer_gTbr docMainContainerEnhanced_Uz_u"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Dependency resolution in the EDC</h1><p>The code base of the Eclipse Dataspace Connector is architected in away that allows for easily extending and swapping
the core functionality using certain plug-points called <em>extensions</em>. One example would be to swap out an in-memory
implementation for a datastore for one backed by an actual database. In order to achieve that there are several key
components:</p><ul><li>a service interface, typically located in an SPI module</li><li>a module providing the implementation, typically located in the <code>extensions</code> directory</li><li>the service registry, i.e. the <code>ServiceExtensionContext</code>. Since it is not quite an IoC container, we&#x27;ll henceforth
refer to it as the &quot;context&quot;.</li><li>a hook point into the loading sequence: an extension that instantiates and registers the implementation class with the
context</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="registering-a-service-implementation">Registering a service implementation<a class="hash-link" href="#registering-a-service-implementation" title="Direct link to heading">â€‹</a></h2><p>As a general rule the module that provides the implementation also should register it with the <code>ServiceExtensionContext</code>
. This is done in an accompanying service extension. For example, providing a CosmosDB based implementation for
a <code>FooStore</code> (stores <code>Foo</code> objects) would require the following classes:</p><ol><li>A <code>FooStore.java</code> interface, located in SPI:<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public interface FooService {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void store(Foo foo);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}   </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li>A <code>CosmosFooStore.java</code> class implementing the interface, located in <code>:extensions:azure:cosmos:foo-store-cosmos</code>:<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class CosmosFooStore implements FooStore {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void store(Foo foo){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li>A <code>CosmosFooStoreExtension.java</code> located also in <code>:extensions:azure:cosmos:foo-store-cosmos</code>. Must be accompanied by
a <em>&quot;provider-configuration file&quot;</em> as required by
the <a href="https://docs.oracle.com/javase/8/docs/api/java/util/ServiceLoader.html" target="_blank" rel="noopener noreferrer"><code>ServiceLoader</code> documentation</a>. Code
examples will follow below.</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="option-1-use-provider-methods-recommended">Option 1: use <code>@Provider</code> methods (recommended)<a class="hash-link" href="#option-1-use-provider-methods-recommended" title="Direct link to heading">â€‹</a></h3><p>Every <code>ServiceExtension</code> may declare methods that are annotated with <code>@Provider</code>, which tells the dependency resolution
mechanism, that this method contributes a dependency into the context. This is very similar to other DI containers, e.g.
Spring&#x27;s <code>@Bean</code>
annotation. It looks like this:</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class CosmosFooStoreExtension implements ServiceExtension {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void initialize(ServiceExtensionContext context) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //Example 1: no args</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Provider</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public SomeService provideSomeService() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return new SomeServiceImpl();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //Example 2: using context</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Provider</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public FooStore provideFooStore(ServiceExtensionContext context) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var setting = context.getSetting(&quot;...&quot;, null);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return new CosmosFooStore(setting);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>As the previous code snipped shows, provider methods may have no args, or a single argument, which is
the <code>ServiceExtensionContext</code>. There are a few other restrictions too. Violating these will raise an exception. Provider
methods must:</p><ul><li>be public</li><li>return a value (<code>void</code> is not allowed)</li><li>either have no arguments, or a single <code>ServiceExtensionContext</code>.</li></ul><p>Having a provider method is equivalent to invoking <code>context.registerService(SomeService, new SomeServiceImpl())</code>. Thus,
the return type of the method defines the service <code>type</code>, whatever is returned by the provider method determines the
implementation of the service.</p><p><strong>Caution</strong>: there is a slight difference between declaring <code>@Provider</code> methods and
calling <code>service.registerService(...)</code> with respect to sequence: the DI loader mechanism <em>first</em>
invokes <code>ServiceExtension#initialize()</code>, and
<em>then</em> invokes all provider methods. In most situations this difference is negligible, but there could be situations,
where this matters.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="provide-defaults">Provide &quot;defaults&quot;<a class="hash-link" href="#provide-defaults" title="Direct link to heading">â€‹</a></h4><p>Where <code>@Provider</code> methods really come into their own is when providing default implementations. This means we can have a
fallback implementation. For example, going back to our <code>FooStore</code> example, there could be an extension that provides a
default (=in-mem)
implementation:</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class DefaultsExtension implements ServiceExtension {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void initialize(ServiceExtensionContext context) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Provider(isDefault = true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public FooStore provideDefaultFooStore() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return new InMemoryFooStore();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Provider methods configured with <code>isDefault=true</code> are only invoked, if the respective service (here: <code>FooStore</code>) is not
provided by any other extension.</p><blockquote><p>Default provider methods are a tricky topic, please be sure to thoroughly read the additional documentation about
them <a href="/edc-docs/docs/submodule/Connector/docs/developer/default_provider_methods">here</a>!</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="option-2-register-manually">Option 2: register manually<a class="hash-link" href="#option-2-register-manually" title="Direct link to heading">â€‹</a></h3><p>Of course, it is also possible to manually register services by invoking the respective method on
the <code>ServiceExtensionContext</code></p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Provides(FooStore.class/*, possibly others*/)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class CosmosFooStoreExtension implements ServiceExtension {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void initialize(ServiceExtensionContext context) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var setting = context.getSetting(&quot;...&quot;, null);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var store = new CosmosFooStore(setting);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        context.registerService(FooStore.class, store);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>There are three important things to mention:</p><ol><li>the call to <code>context#registerService</code> makes the object available in the context. From this point on other extensions
can inject a <code>FooStore</code> (and in doing so will receive a <code>CosmosFooStore</code>).</li><li>declaring the exposed interface in the <code>@Provides()</code> annotation is required, as it helps the extension loader define
the order in which it needs to initialize extensions</li><li>service registrations <strong>must</strong> be done in the <code>initialize()</code> method.</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="injecting-a-service">Injecting a service<a class="hash-link" href="#injecting-a-service" title="Direct link to heading">â€‹</a></h2><p>Services should only be referenced by the interface they implement. This will keep dependencies clean and maintain
extensibility and modularity. Say we have a <code>FooMaintenanceService</code> that receives <code>Foo</code> objects over an arbitrary
network channel and stores them.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="option-1-use-inject-to-declare-dependencies-recommended">Option 1: use <code>@Inject</code> to declare dependencies (recommended)<a class="hash-link" href="#option-1-use-inject-to-declare-dependencies-recommended" title="Direct link to heading">â€‹</a></h3><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class FooMaintenanceService {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final FooStore fooStore;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public FooMaintenanceService(FooStore fooStore) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.fooStore = fooStore;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note that the example uses what we call <em>constructor injection</em> (even though nothing is actually <em>injected</em>), because
that is needed for object construction, and it increases testability. Also, those types of class fields should be
declared <code>final</code> to avoid programming errors.</p><p>In contrast to conventional DI frameworks the <code>fooStore</code> dependency won&#x27;t get auto-injected - rather, there has to be
another <code>ServiceExtension</code> that has a reference to the <code>FooStore</code> and that constructs the <code>FooMaintenanceService</code>:</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class FooMaintenanceExtension implements ServiceExtension {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Inject</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private FooStore fooStore;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void initialize(ServiceExtensionContext context) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var service = new FooMaintenanceService(fooStore); //use the injected field</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>@Inject</code> annotation on the <code>fooStore</code> field tells the extension loading mechanism that <code>FooMaintenanceExtension</code>
depends on a <code>FooService</code> and because of that, any provider of a <code>FooStore</code> must be initialized <em>before</em>
the <code>FooMaintenanceExtension</code>. The fact that <code>CosmosFooStoreExtension</code> provides a <code>FooStore</code> is declared using
the <code>@Provides</code> annotation.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="option-2-use-requires-to-declare-dependencies">Option 2: use <code>@Requires</code> to declare dependencies<a class="hash-link" href="#option-2-use-requires-to-declare-dependencies" title="Direct link to heading">â€‹</a></h3><p>In cases where defining a field seems unwieldy or is simply not desirable, we provide another way to dynamically resolve
service from the context:</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Requires({ FooService.class, /*maybe others*/ })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class FooMaintenanceExtension implements ServiceExtension {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void initialize(ServiceExtensionContext context) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var fooStore = context.getService(FooStore.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var service = new FooMaintenanceService(fooStore); //use the resolved object</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The important issue to mention is that <code>@Requires</code> is absolutely necessary to inform the service loader about the
dependency. Failing to add it this may potentially result in exceptions, and in further consequence, in
an <code>EdcInjectionException</code>.</p><p>Option 1 and 2 are almost semantically equivalent, with the small exception of optional dependencies:
while <code>@Inject(required=false)</code> allows for nullable dependencies, <code>@Requires</code> has no such option and the service
dependency must be resolved explicitly using a boolean parameter <code>context.getService(FooStore.class, true)</code>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="extension-initialization-sequence">Extension initialization sequence<a class="hash-link" href="#extension-initialization-sequence" title="Direct link to heading">â€‹</a></h2><p>The extension loading mechanism uses a two-pass procedure to resolve dependencies. First, all implementors
of <code>ServiceExtension</code> are instantiated using their public default constructor, put in a list and sorted using a
topological sort algorithm based on their dependency graph. Cyclic dependencies would be reported in this stage.</p><p>Second, the extension is initialized by setting all fields annotated with <code>@Inject</code> and by calling its <code>initialize()</code>
method. This implies that every extension can assume that by the time its <code>initialize()</code> method executes, all its
dependencies are already instantiated and registered, because the extension(s) providing them were ordered at previous
positions in the list, and thus have already been initialized.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="tests-for-classes-using-injection">Tests for classes using injection<a class="hash-link" href="#tests-for-classes-using-injection" title="Direct link to heading">â€‹</a></h2><p>To test classes using the <code>@Inject</code> annotation, use the appropriate JUnit extension:</p><ul><li>If only basic dependency injection is needed (unit testing), use the <code>DependencyInjectionExtension</code>.</li><li>If the full EDC runtime should be run (integration testing), use the <code>EdcExtension</code>.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="limitations-and-differences-to-fully-fledged-ioc-containers">Limitations and differences to fully-fledged IoC containers<a class="hash-link" href="#limitations-and-differences-to-fully-fledged-ioc-containers" title="Direct link to heading">â€‹</a></h2><h4 class="anchor anchorWithStickyNavbar_LWe7" id="only-available-in-serviceextensions">Only available in <code>ServiceExtensions</code><a class="hash-link" href="#only-available-in-serviceextensions" title="Direct link to heading">â€‹</a></h4><p>Services can only be injected into <code>ServiceExtension</code> objects at this time as they are the main hook points for plugins,
and they have a clearly defined interface. All subsequent object creation must be done manually using conventional
mechanisms like constructors or builders.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="no-multiple-registrations">No multiple registrations<a class="hash-link" href="#no-multiple-registrations" title="Direct link to heading">â€‹</a></h4><p>Registering two implementations for an interface will result in the first registration being overwritten by the second
registration. If both providers have the same topological ordering it is undefined whichever comes first. A warning is
posted to the <code>Monitor</code>.</p><p><em>It was a conscientious architectural decision to forego multiple service registrations for the sake of simplicity and
clean design. Patterns like composites or delegators exist for those rare cases where having multiple implementors of
the same interface is indeed needed. Those should be used sparingly and not without a strong reason.</em></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="no-collection-based-injection">No collection-based injection<a class="hash-link" href="#no-collection-based-injection" title="Direct link to heading">â€‹</a></h4><p>Because there can be only ever one implementation for a service, it is not possible to inject a collection of
implementors as it would be in other DI frameworks.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="only-field-injection">Only field injection<a class="hash-link" href="#only-field-injection" title="Direct link to heading">â€‹</a></h4><p>At the moment the <code>@Inject</code> annotation can only target fields, meaning, that we cannot perform constructor or setter
injection with it, for example <code>public SomeExtension(@Inject SomeService someService){ ... }</code> would not be possible.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="no-named-dependencies">No named dependencies<a class="hash-link" href="#no-named-dependencies" title="Direct link to heading">â€‹</a></h4><p>Dependencies cannot be decorated with an identifier, which would technically allow for multiple service registrations (
using different names). Technically this is linked to the limitation of single service registrations.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="direct-inheritorsimplementors-only">Direct inheritors/implementors only<a class="hash-link" href="#direct-inheritorsimplementors-only" title="Direct link to heading">â€‹</a></h4><p>This is not due to a limitation of the dependency injection mechanism, but rather due to the way how the context
maintains service registrations: it simply maintains a <code>Map</code> containing interface class and implementation type.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="cyclic-dependencies">Cyclic dependencies<a class="hash-link" href="#cyclic-dependencies" title="Direct link to heading">â€‹</a></h4><p>Cyclic dependencies are detected by the <code>TopologicalSort</code> algorithm, but the error reporting is a bit limited.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="no-generic-dependencies">No generic dependencies<a class="hash-link" href="#no-generic-dependencies" title="Direct link to heading">â€‹</a></h4><p>It&#x27;s not possible to have dependencies with a type parameter.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/FraunhoferISST/edc-docs/tree/master/docs/submodule/Connector/docs/developer/dependency_resolution.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#registering-a-service-implementation" class="table-of-contents__link toc-highlight">Registering a service implementation</a><ul><li><a href="#option-1-use-provider-methods-recommended" class="table-of-contents__link toc-highlight">Option 1: use <code>@Provider</code> methods (recommended)</a></li><li><a href="#option-2-register-manually" class="table-of-contents__link toc-highlight">Option 2: register manually</a></li></ul></li><li><a href="#injecting-a-service" class="table-of-contents__link toc-highlight">Injecting a service</a><ul><li><a href="#option-1-use-inject-to-declare-dependencies-recommended" class="table-of-contents__link toc-highlight">Option 1: use <code>@Inject</code> to declare dependencies (recommended)</a></li><li><a href="#option-2-use-requires-to-declare-dependencies" class="table-of-contents__link toc-highlight">Option 2: use <code>@Requires</code> to declare dependencies</a></li></ul></li><li><a href="#extension-initialization-sequence" class="table-of-contents__link toc-highlight">Extension initialization sequence</a></li><li><a href="#tests-for-classes-using-injection" class="table-of-contents__link toc-highlight">Tests for classes using injection</a></li><li><a href="#limitations-and-differences-to-fully-fledged-ioc-containers" class="table-of-contents__link toc-highlight">Limitations and differences to fully-fledged IoC containers</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__links text--center"><div class="footer__links"><a href="https://projects.eclipse.org/projects/technology.edc/contact" target="_blank" rel="noopener noreferrer" class="footer__link-item">Contact<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><span class="footer__link-separator">Â·</span><a href="https://www.youtube.com/channel/UCYmjEHtMSzycheBB4AeITHg" target="_blank" rel="noopener noreferrer" class="footer__link-item">Youtube<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><span class="footer__link-separator">Â·</span><a href="https://projects.eclipse.org/projects/technology.edc" target="_blank" rel="noopener noreferrer" class="footer__link-item">EF Project<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2023 Eclipse Dataspace Components, built with Docusaurus.</div></div></div></footer></div>
<script src="/edc-docs/assets/js/runtime~main.c2e953c9.js"></script>
<script src="/edc-docs/assets/js/main.ee9e8729.js"></script>
</body>
</html>