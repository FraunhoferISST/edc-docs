"use strict";(self.webpackChunkedc_docs=self.webpackChunkedc_docs||[]).push([[6230],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var i=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,i,a=function(e,t){if(null==e)return{};var n,i,a={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=i.createContext({}),c=function(e){var t=i.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},p=function(e){var t=c(e.components);return i.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},d=i.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),d=c(n),m=a,h=d["".concat(s,".").concat(m)]||d[m]||u[m]||o;return n?i.createElement(h,r(r({ref:t},p),{},{components:n})):i.createElement(h,r({ref:t},p))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,r=new Array(o);r[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,r[1]=l;for(var c=2;c<o;c++)r[c]=n[c];return i.createElement.apply(null,r)}return i.createElement.apply(null,n)}d.displayName="MDXCreateElement"},82036:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>r,default:()=>u,frontMatter:()=>o,metadata:()=>l,toc:()=>c});var i=n(87462),a=(n(67294),n(3905));const o={},r="Policies in EDC",l={unversionedId:"submodule/Connector/docs/developer/architecture/usage-control/policies",id:"submodule/Connector/docs/developer/architecture/usage-control/policies",title:"Policies in EDC",description:"Purpose of this guide is to give an overview of what policies are and how they work in EDC.",source:"@site/docs/submodule/Connector/docs/developer/architecture/usage-control/policies.md",sourceDirName:"submodule/Connector/docs/developer/architecture/usage-control",slug:"/submodule/Connector/docs/developer/architecture/usage-control/policies",permalink:"/edc-docs/docs/submodule/Connector/docs/developer/architecture/usage-control/policies",draft:!1,editUrl:"https://github.com/FraunhoferISST/edc-docs/tree/master/docs/submodule/Connector/docs/developer/architecture/usage-control/policies.md",tags:[],version:"current",frontMatter:{}},s={},c=[{value:"What are policies?",id:"what-are-policies",level:2},{value:"Defining policies",id:"defining-policies",level:2},{value:"Constraints",id:"constraints",level:2},{value:"Defining custom rule functions",id:"defining-custom-rule-functions",level:2},{value:"Custom policy models",id:"custom-policy-models",level:2}],p={toc:c};function u(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,i.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"policies-in-edc"},"Policies in EDC"),(0,a.kt)("p",null,"Purpose of this guide is to give an overview of what policies are and how they work in EDC.\nPolicy model used internally is based on the ",(0,a.kt)("a",{parentName:"p",href:"https://www.w3.org/TR/odrl-model/"},"Open Digital Rights Language (ODRL)")," and going\nthrough it would help get a more complete picture. Nevertheless, this guide can be followed without it and the sections below\nprovide a simplified overview of the main ODRL concepts."),(0,a.kt)("h2",{id:"what-are-policies"},"What are policies?"),(0,a.kt)("p",null,"Conceptually, a policy is a non-empty collection of rules, which specify actions the consumer is ",(0,a.kt)("em",{parentName:"p"},"allowed"),", ",(0,a.kt)("em",{parentName:"p"},"disallowed"),"\nor ",(0,a.kt)("em",{parentName:"p"},"required")," to perform on an Asset, optionally refined by a set of constraints."),(0,a.kt)("p",null,"As indicated above, rules come in three types:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Permissions"),", which specify actions the consumer is allowed to perform on an asset",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("em",{parentName:"li"},"Example"),": permission to use the asset, but only if the consumer is in the EU region"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Prohibitions"),", which specify actions the consumer is not allowed to perform on an asset",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("em",{parentName:"li"},"Example"),": prohibiting further distribution of the asset"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Obligations")," (a.k.a. ",(0,a.kt)("strong",{parentName:"li"},"Duties"),"), which specify actions the consumer is required to perform",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("em",{parentName:"li"},"Example"),": obligation to delete the data after 30 days")))),(0,a.kt)("p",null,"It is possible to link these entities together, forming more complex rule chains. For example, a ",(0,a.kt)("em",{parentName:"p"},"Prohibition")," can be\nextended with a set of ",(0,a.kt)("em",{parentName:"p"},"Obligations"),", specifying actions that need to be performed in case the prohibition has been infringed."),(0,a.kt)("p",null,"For more details of the possible use cases, please consult the ODRL documentation.\nUnless stated otherwise, all models mentioned below can be found in the ",(0,a.kt)("inlineCode",{parentName:"p"},"org.eclipse.edc.policy.model")," package."),(0,a.kt)("h2",{id:"defining-policies"},"Defining policies"),(0,a.kt)("p",null,"Before we can define the policy itself, we first need to define one or more rules (permissions, prohibitions or obligations) that will make up the policy.\nUsing the examples given above, we can add the following:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},'var readPermission = Permission.Builder.newInstance()\n    .action(Action.Builder.newInstance().type("READ").build())\n    .build();\n\nvar distributeProhibition = Prohibition.Builder.newInstance()\n    .action(Action.Builder.newInstance().type("DISTRIBUTE").build())\n    .build();\n')),(0,a.kt)("p",null,"With the code above, we have defined a permission, allowing a read access to an asset, as well as a prohibition,\ndisallowing further distribution of an asset. Rules are envisioned to be reusable, so the ones define above can be associated\nwith any number of policies, and by extension, assets."),(0,a.kt)("p",null,"Next, we create the actual policy and attach it to the asset."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},'var readNotDistributePolicy = Policy.Builder.newInstance()\n    .id("use-all")\n    .permission(readPermission)\n    .prohibition(distributeProhibition)\n    .target("test-document")\n    .build();\n')),(0,a.kt)("p",null,"Policies can be evaluated using an instance of the ",(0,a.kt)("em",{parentName:"p"},"PolicyEngine")," class. Simplest way is to use one provided by the ",(0,a.kt)("em",{parentName:"p"},"ServiceExtensionContext"),"."),(0,a.kt)("p",null,"During evaluation, verifiable claims and attributes sent by the other connector are also available, represented by an instance of the ",(0,a.kt)("em",{parentName:"p"},"ParticipantAgent")," class.\nIn this case, we will assume no claims or attributes have been sent. We will extend this in one of the subsequent examples."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},"var policyEngine = serviceContext.getService(PolicyEngine.class);\nvar agent = new ParticipantAgent(Collections.emptyMap(), Collections.emptyMap());\nvar result = policyEngine.evaluate(usePolicy, agent);\n\nresult.isValid();\n")),(0,a.kt)("p",null,"Result of the last expression is a boolean value specifying whether all rules have been satisfied."),(0,a.kt)("h2",{id:"constraints"},"Constraints"),(0,a.kt)("p",null,"While the rules above can be used to cover simple scenarios, things usually aren't so clear-cut. Perhaps we would like to\nlimit the use of an asset to consumer connectors located in EU, or introduce an embargo, preventing further asset distribution before a specific date."),(0,a.kt)("p",null,"In these cases, rules can be extended with one or more constraints, which further refine the semantics of a rule. A ",(0,a.kt)("em",{parentName:"p"},"Constraint"),", in its simplest terms,\nis a logical expression that can be evaluated on the provider and/or consumer side, and whose result (a boolean value) shows whether the refinement has been satisfied."),(0,a.kt)("p",null,"It comes in two flavors:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"AtomicConstraint")," - a binary boolean expression, in a ",(0,a.kt)("inlineCode",{parentName:"li"},"leftOperand operator rightOperand")," form",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("em",{parentName:"li"},"Example"),": ",(0,a.kt)("inlineCode",{parentName:"li"},'"region" EQUALS "eu"'),", ",(0,a.kt)("inlineCode",{parentName:"li"},'dateTime LESS_THAN "2021-12-31T00:00:00"')))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"MultiplicityConstraint")," (and it's subclasses) - a collection of Constraints linked with logical operators",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Concrete implementations include the And, Or and OnlyOne constraints"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("em",{parentName:"li"},"Example"),": ",(0,a.kt)("inlineCode",{parentName:"li"},"euConstraint AND goldPartnerConstraint AND notUnderEmbargoConstraint"))))),(0,a.kt)("p",null,"Similar to rules, these constraints can be nested, to form arbitrarily complex logical expressions."),(0,a.kt)("p",null,"Extending the example above, we can refine our read permission:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},'var euConstraint = AtomicConstraint.Builder.newInstance()\n    .leftExpression(new LiteralExpression("region"))\n    .operator(EQ)\n    .rightExpression(new LiteralExpression("eu"))\n    .build();\n\nvar readPermission = Permission.Builder.newInstance()\n    .action(Action.Builder.newInstance().type("READ").build())\n    .constraint(euConstraint)   // This line is new\n    .build();\n')),(0,a.kt)("p",null,"Keep in mind that with the lines above we have just expressed an assertion that needs to be true, and not yet defined how the\nevaluation of such assertion should proceed (e.g. where is the ",(0,a.kt)("inlineCode",{parentName:"p"},"region")," value retrieved from?).\nTo do this, in the next section we will define our custom rule functions that will be invoked to process these constraints."),(0,a.kt)("h2",{id:"defining-custom-rule-functions"},"Defining custom rule functions"),(0,a.kt)("p",null,"If left as is, the expression ",(0,a.kt)("inlineCode",{parentName:"p"},'"region" EQ "eu"')," will always evaluate to false, since the literals ",(0,a.kt)("inlineCode",{parentName:"p"},'"region"')," and ",(0,a.kt)("inlineCode",{parentName:"p"},'"eu"')," will\nbe compared by equality. What we actually wanted is for the value of the left operand, ",(0,a.kt)("em",{parentName:"p"},"region"),", to be retrieved / generated from the provided input.\nSuch computed value should then be compared with the literal ",(0,a.kt)("inlineCode",{parentName:"p"},'"eu"')," to produce the final result."),(0,a.kt)("p",null,"For this, we will define a rule function, that will be called every time a rule with ",(0,a.kt)("inlineCode",{parentName:"p"},'"region"')," as the left operand needs to be evaluated.\nThis rule function needs to be available to the policy engine object which will be later used to evaluate this policy."),(0,a.kt)("p",null,"For the purpose of this example, we will extract the region of the consumer connector from the claims it provides:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},'// Assuming we already have this from previous snippets\n// var policyEngine = serviceContext.getService(PolicyEngine.class);\n\npolicyEngine.registerFunction(\n  Permission.class, \n  "region", \n  (operator, rightOperand, permission, context) -> {\n    var consumerRegion = context.getParticipantAgent().getClaims().get("region"); // #1\n    switch (operator){\n      case EQ:\n        return Objects.equals(consumerRegion, rightOperand); \n      default:\n        return false;\n    }\n  }\n);\n')),(0,a.kt)("p",null,"At ",(0,a.kt)("strong",{parentName:"p"},"#1"),", we are extracting the value from the verifiable claims provided by the other connector. In case of the embargo example,\nwe would be using the current datetime for the value of the left operand."),(0,a.kt)("p",null,"Putting it all together, we will again try to evaluate the policy, this time using a connector which has some verifiable claims."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},'agent = new ParticipantAgent(Map.of("region", "eu"), Collections.emptyMap());\nresult = policyEngine.evaluate(usePolicy, agent);\n\nresult.isValid();\n')),(0,a.kt)("p",null,"Once the policy evaluation reaches the ",(0,a.kt)("inlineCode",{parentName:"p"},"euConstraint"),", left operand ",(0,a.kt)("inlineCode",{parentName:"p"},'"region"')," will be resolved to value ",(0,a.kt)("inlineCode",{parentName:"p"},'"eu"')," coming from the\nprovided verifiable claims, using the function above. This value will be compared against the right operand ",(0,a.kt)("inlineCode",{parentName:"p"},'"eu"'),",\ndefined in the ",(0,a.kt)("inlineCode",{parentName:"p"},"euConstraint"),", giving us a positive result."),(0,a.kt)("h2",{id:"custom-policy-models"},"Custom policy models"),(0,a.kt)("p",null,"While the ODRL policy model is one used by the EDC core, data protocols are free to introduce their own policy models."),(0,a.kt)("p",null,"This way custom data protocol can be used to exchange information between participating connectors,\nwhile still leveraging the policy evaluation capabilities of the connector core."),(0,a.kt)("p",null,"In this section we'll take a look at how to define transformers between a custom policy model and the EDC one,\non the example of the IDS model. Full code of all relevant IDS transformers can be found in ",(0,a.kt)("inlineCode",{parentName:"p"},"data-protocols/ids/ids-transform-v1"),"."),(0,a.kt)("p",null,"To begin, we will need an instance of the ",(0,a.kt)("em",{parentName:"p"},"TransformerRegistry")," class, which acts as dispatcher, calling appropriate IDS-EDC or EDC-IDS type converters.\nAs with all services, it can be retrieved from the ",(0,a.kt)("em",{parentName:"p"},"ServiceExtensionContext"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},'var transformerRegistry = serviceContext.getService(TransformerRegistry.class);\n\nvar readPermission = Permission.Builder.newInstance()\n  .action(Action.Builder.newInstance().type("idsc:READ").build())   // Updated\n  .constraint(euConstraint)\n  .build();\n\nvar transformResult = transformerRegistry.transform(readPermission, de.fraunhofer.iais.eis.Permission.class);\n')),(0,a.kt)("p",null,"Note the change of type from ",(0,a.kt)("inlineCode",{parentName:"p"},"READ")," to ",(0,a.kt)("inlineCode",{parentName:"p"},"idsc:READ")," compared to our previous example. While the former is following the EDC model,\nlatter follows the IDC policy model."),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"transformResult")," will contain either a list of issues that appeared during the conversion, available through ",(0,a.kt)("inlineCode",{parentName:"p"},"transformResult.getProblems()")," or\nthe actual result of the conversion, available through ",(0,a.kt)("inlineCode",{parentName:"p"},"transformResult.getOutput()"),"."))}u.isMDXComponent=!0}}]);