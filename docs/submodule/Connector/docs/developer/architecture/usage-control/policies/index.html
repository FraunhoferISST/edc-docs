<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-submodule/Connector/docs/developer/architecture/usage-control/policies">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">Policies in EDC | My Site</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://FraunhoferISST.github.io/edc-docs/docs/submodule/Connector/docs/developer/architecture/usage-control/policies"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Policies in EDC | My Site"><meta data-rh="true" name="description" content="Purpose of this guide is to give an overview of what policies are and how they work in EDC."><meta data-rh="true" property="og:description" content="Purpose of this guide is to give an overview of what policies are and how they work in EDC."><link data-rh="true" rel="icon" href="/edc-docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://FraunhoferISST.github.io/edc-docs/docs/submodule/Connector/docs/developer/architecture/usage-control/policies"><link data-rh="true" rel="alternate" href="https://FraunhoferISST.github.io/edc-docs/docs/submodule/Connector/docs/developer/architecture/usage-control/policies" hreflang="en"><link data-rh="true" rel="alternate" href="https://FraunhoferISST.github.io/edc-docs/docs/submodule/Connector/docs/developer/architecture/usage-control/policies" hreflang="x-default"><link rel="stylesheet" href="/edc-docs/assets/css/styles.5bd81ef5.css">
<link rel="preload" href="/edc-docs/assets/js/runtime~main.b3ae5d38.js" as="script">
<link rel="preload" href="/edc-docs/assets/js/main.b883e2b3.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/edc-docs/"><div class="navbar__logo"><img src="/edc-docs/img/icon.png" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/edc-docs/img/icon.png" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a><a class="navbar__item navbar__link" href="/edc-docs/docs/">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/eclipse-dataspacecomponents/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><main class="docMainContainer_gTbr docMainContainerEnhanced_Uz_u"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Policies in EDC</h1><p>Purpose of this guide is to give an overview of what policies are and how they work in EDC.
Policy model used internally is based on the <a href="https://www.w3.org/TR/odrl-model/" target="_blank" rel="noopener noreferrer">Open Digital Rights Language (ODRL)</a> and going
through it would help get a more complete picture. Nevertheless, this guide can be followed without it and the sections below
provide a simplified overview of the main ODRL concepts.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-are-policies">What are policies?<a class="hash-link" href="#what-are-policies" title="Direct link to heading">​</a></h2><p>Conceptually, a policy is a non-empty collection of rules, which specify actions the consumer is <em>allowed</em>, <em>disallowed</em>
or <em>required</em> to perform on an Asset, optionally refined by a set of constraints.</p><p>As indicated above, rules come in three types:</p><ul><li><strong>Permissions</strong>, which specify actions the consumer is allowed to perform on an asset<ul><li><em>Example</em>: permission to use the asset, but only if the consumer is in the EU region</li></ul></li><li><strong>Prohibitions</strong>, which specify actions the consumer is not allowed to perform on an asset<ul><li><em>Example</em>: prohibiting further distribution of the asset</li></ul></li><li><strong>Obligations</strong> (a.k.a. <strong>Duties</strong>), which specify actions the consumer is required to perform<ul><li><em>Example</em>: obligation to delete the data after 30 days</li></ul></li></ul><p>It is possible to link these entities together, forming more complex rule chains. For example, a <em>Prohibition</em> can be
extended with a set of <em>Obligations</em>, specifying actions that need to be performed in case the prohibition has been infringed.</p><p>For more details of the possible use cases, please consult the ODRL documentation.
Unless stated otherwise, all models mentioned below can be found in the <code>org.eclipse.edc.policy.model</code> package.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="defining-policies">Defining policies<a class="hash-link" href="#defining-policies" title="Direct link to heading">​</a></h2><p>Before we can define the policy itself, we first need to define one or more rules (permissions, prohibitions or obligations) that will make up the policy.
Using the examples given above, we can add the following:</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">var readPermission = Permission.Builder.newInstance()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .action(Action.Builder.newInstance().type(&quot;READ&quot;).build())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var distributeProhibition = Prohibition.Builder.newInstance()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .action(Action.Builder.newInstance().type(&quot;DISTRIBUTE&quot;).build())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .build();</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>With the code above, we have defined a permission, allowing a read access to an asset, as well as a prohibition,
disallowing further distribution of an asset. Rules are envisioned to be reusable, so the ones define above can be associated
with any number of policies, and by extension, assets.</p><p>Next, we create the actual policy and attach it to the asset.</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">var readNotDistributePolicy = Policy.Builder.newInstance()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .id(&quot;use-all&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .permission(readPermission)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .prohibition(distributeProhibition)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .target(&quot;test-document&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .build();</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Policies can be evaluated using an instance of the <em>PolicyEngine</em> class. Simplest way is to use one provided by the <em>ServiceExtensionContext</em>.</p><p>During evaluation, verifiable claims and attributes sent by the other connector are also available, represented by an instance of the <em>ParticipantAgent</em> class.
In this case, we will assume no claims or attributes have been sent. We will extend this in one of the subsequent examples.</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">var policyEngine = serviceContext.getService(PolicyEngine.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var agent = new ParticipantAgent(Collections.emptyMap(), Collections.emptyMap());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var result = policyEngine.evaluate(usePolicy, agent);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">result.isValid();</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Result of the last expression is a boolean value specifying whether all rules have been satisfied.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="constraints">Constraints<a class="hash-link" href="#constraints" title="Direct link to heading">​</a></h2><p>While the rules above can be used to cover simple scenarios, things usually aren&#x27;t so clear-cut. Perhaps we would like to
limit the use of an asset to consumer connectors located in EU, or introduce an embargo, preventing further asset distribution before a specific date.</p><p>In these cases, rules can be extended with one or more constraints, which further refine the semantics of a rule. A <em>Constraint</em>, in its simplest terms,
is a logical expression that can be evaluated on the provider and/or consumer side, and whose result (a boolean value) shows whether the refinement has been satisfied.</p><p>It comes in two flavors:</p><ul><li><strong>AtomicConstraint</strong> - a binary boolean expression, in a <code>leftOperand operator rightOperand</code> form<ul><li><em>Example</em>: <code>&quot;region&quot; EQUALS &quot;eu&quot;</code>, <code>dateTime LESS_THAN &quot;2021-12-31T00:00:00&quot;</code></li></ul></li><li><strong>MultiplicityConstraint</strong> (and it&#x27;s subclasses) - a collection of Constraints linked with logical operators<ul><li>Concrete implementations include the And, Or and OnlyOne constraints</li><li><em>Example</em>: <code>euConstraint AND goldPartnerConstraint AND notUnderEmbargoConstraint</code></li></ul></li></ul><p>Similar to rules, these constraints can be nested, to form arbitrarily complex logical expressions.</p><p>Extending the example above, we can refine our read permission:</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">var euConstraint = AtomicConstraint.Builder.newInstance()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .leftExpression(new LiteralExpression(&quot;region&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .operator(EQ)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .rightExpression(new LiteralExpression(&quot;eu&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var readPermission = Permission.Builder.newInstance()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .action(Action.Builder.newInstance().type(&quot;READ&quot;).build())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .constraint(euConstraint)   // This line is new</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .build();</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Keep in mind that with the lines above we have just expressed an assertion that needs to be true, and not yet defined how the
evaluation of such assertion should proceed (e.g. where is the <code>region</code> value retrieved from?).
To do this, in the next section we will define our custom rule functions that will be invoked to process these constraints.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="defining-custom-rule-functions">Defining custom rule functions<a class="hash-link" href="#defining-custom-rule-functions" title="Direct link to heading">​</a></h2><p>If left as is, the expression <code>&quot;region&quot; EQ &quot;eu&quot;</code> will always evaluate to false, since the literals <code>&quot;region&quot;</code> and <code>&quot;eu&quot;</code> will
be compared by equality. What we actually wanted is for the value of the left operand, <em>region</em>, to be retrieved / generated from the provided input.
Such computed value should then be compared with the literal <code>&quot;eu&quot;</code> to produce the final result.</p><p>For this, we will define a rule function, that will be called every time a rule with <code>&quot;region&quot;</code> as the left operand needs to be evaluated.
This rule function needs to be available to the policy engine object which will be later used to evaluate this policy.</p><p>For the purpose of this example, we will extract the region of the consumer connector from the claims it provides:</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Assuming we already have this from previous snippets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// var policyEngine = serviceContext.getService(PolicyEngine.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">policyEngine.registerFunction(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Permission.class, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;region&quot;, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (operator, rightOperand, permission, context) -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    var consumerRegion = context.getParticipantAgent().getClaims().get(&quot;region&quot;); // #1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    switch (operator){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      case EQ:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return Objects.equals(consumerRegion, rightOperand); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      default:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>At <strong>#1</strong>, we are extracting the value from the verifiable claims provided by the other connector. In case of the embargo example,
we would be using the current datetime for the value of the left operand.</p><p>Putting it all together, we will again try to evaluate the policy, this time using a connector which has some verifiable claims.</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">agent = new ParticipantAgent(Map.of(&quot;region&quot;, &quot;eu&quot;), Collections.emptyMap());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">result = policyEngine.evaluate(usePolicy, agent);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">result.isValid();</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Once the policy evaluation reaches the <code>euConstraint</code>, left operand <code>&quot;region&quot;</code> will be resolved to value <code>&quot;eu&quot;</code> coming from the
provided verifiable claims, using the function above. This value will be compared against the right operand <code>&quot;eu&quot;</code>,
defined in the <code>euConstraint</code>, giving us a positive result.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="custom-policy-models">Custom policy models<a class="hash-link" href="#custom-policy-models" title="Direct link to heading">​</a></h2><p>While the ODRL policy model is one used by the EDC core, data protocols are free to introduce their own policy models.</p><p>This way custom data protocol can be used to exchange information between participating connectors,
while still leveraging the policy evaluation capabilities of the connector core.</p><p>In this section we&#x27;ll take a look at how to define transformers between a custom policy model and the EDC one,
on the example of the IDS model. Full code of all relevant IDS transformers can be found in <code>data-protocols/ids/ids-transform-v1</code>.</p><p>To begin, we will need an instance of the <em>TransformerRegistry</em> class, which acts as dispatcher, calling appropriate IDS-EDC or EDC-IDS type converters.
As with all services, it can be retrieved from the <em>ServiceExtensionContext</em>:</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">var transformerRegistry = serviceContext.getService(TransformerRegistry.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var readPermission = Permission.Builder.newInstance()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  .action(Action.Builder.newInstance().type(&quot;idsc:READ&quot;).build())   // Updated</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  .constraint(euConstraint)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var transformResult = transformerRegistry.transform(readPermission, de.fraunhofer.iais.eis.Permission.class);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note the change of type from <code>READ</code> to <code>idsc:READ</code> compared to our previous example. While the former is following the EDC model,
latter follows the IDC policy model.</p><p><code>transformResult</code> will contain either a list of issues that appeared during the conversion, available through <code>transformResult.getProblems()</code> or
the actual result of the conversion, available through <code>transformResult.getOutput()</code>.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/FraunhoferISST/edc-docs/tree/master/docs/submodule/Connector/docs/developer/architecture/usage-control/policies.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#what-are-policies" class="table-of-contents__link toc-highlight">What are policies?</a></li><li><a href="#defining-policies" class="table-of-contents__link toc-highlight">Defining policies</a></li><li><a href="#constraints" class="table-of-contents__link toc-highlight">Constraints</a></li><li><a href="#defining-custom-rule-functions" class="table-of-contents__link toc-highlight">Defining custom rule functions</a></li><li><a href="#custom-policy-models" class="table-of-contents__link toc-highlight">Custom policy models</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 My Project,  built with Fraunhofer ISST.</div></div></div></footer></div>
<script src="/edc-docs/assets/js/runtime~main.b3ae5d38.js"></script>
<script src="/edc-docs/assets/js/main.b883e2b3.js"></script>
</body>
</html>