<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-submodule/MinimumViableDataspace/docs/developer/continuous-deployment/continuous_deployment">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">Continuous Deployment | My Site</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://FraunhoferISST.github.io/edc-docs/docs/submodule/MinimumViableDataspace/docs/developer/continuous-deployment/continuous_deployment"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Continuous Deployment | My Site"><meta data-rh="true" name="description" content="Overview"><meta data-rh="true" property="og:description" content="Overview"><link data-rh="true" rel="icon" href="/edc-docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://FraunhoferISST.github.io/edc-docs/docs/submodule/MinimumViableDataspace/docs/developer/continuous-deployment/continuous_deployment"><link data-rh="true" rel="alternate" href="https://FraunhoferISST.github.io/edc-docs/docs/submodule/MinimumViableDataspace/docs/developer/continuous-deployment/continuous_deployment" hreflang="en"><link data-rh="true" rel="alternate" href="https://FraunhoferISST.github.io/edc-docs/docs/submodule/MinimumViableDataspace/docs/developer/continuous-deployment/continuous_deployment" hreflang="x-default"><link rel="stylesheet" href="/edc-docs/assets/css/styles.5bd81ef5.css">
<link rel="preload" href="/edc-docs/assets/js/runtime~main.bbc09bb1.js" as="script">
<link rel="preload" href="/edc-docs/assets/js/main.bdd0bebb.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/edc-docs/"><div class="navbar__logo"><img src="/edc-docs/img/icon.png" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/edc-docs/img/icon.png" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a><a class="navbar__item navbar__link" href="/edc-docs/docs/">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/eclipse-dataspacecomponents/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><main class="docMainContainer_gTbr docMainContainerEnhanced_Uz_u"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Continuous Deployment</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a class="hash-link" href="#overview" title="Direct link to heading">​</a></h2><p>This document describes how to set up your environment to deploy MVD instances to your Azure subscription.</p><p>Continuous integration and continuous deployment of the MVD to an Azure subscription is performed by <a href="https://github.com/features/actions" target="_blank" rel="noopener noreferrer">GitHub Actions</a> workflows.</p><p>The Azure subscription and and the GitHub repository need to be set up with the required configuration and credentials before the MVD can be deployed.</p><p>The following steps will be performed:</p><ul><li>An <strong>application</strong> is created to represent the action runner that provisions cloud resources. In Azure Active Directory, a service principal for the application is configured in the cloud tenant, and configured to trust the GitHub repository using Federated Identity Credentials.</li><li>Another <strong>application</strong> is created to represent the deployed MVD runtimes for accessing Azure resources (such as Key Vault). For simplicity, all runtimes share a single application identity. In Azure Active Directory, a service principal for the application is configured in the cloud tenant. A client secret is configured to allow the runtime to authenticate.</li><li><a href="https://docs.github.com/en/actions/security-guides/encrypted-secrets" target="_blank" rel="noopener noreferrer">GitHub secrets</a> are created to hold configuration values and credentials.</li></ul><p>Once the configuration is in place, a GitHub workflow needs to be run to provision the Azure resources used for CD:</p><ul><li>An <strong>Azure Container Registry</strong> instance is deployed to contain docker images built in the CI job. These images are deployed to runtime environments in the CD process.</li><li>An <strong>Azure Storage Account</strong> and a storage container to store <strong>Terraform state</strong> between the deployment and destroy jobs.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="planning-your-deployment">Planning Your Deployment<a class="hash-link" href="#planning-your-deployment" title="Direct link to heading">​</a></h2><p>You will need to provide the following:</p><ul><li>An Azure subscription</li><li>Two service principals (instructions to create them below)</li><li>A fork of the <a href="https://github.com/eclipse-dataspaceconnector/MinimumViableDataspace" target="_blank" rel="noopener noreferrer">MVD repository</a> and permissions to configure GitHub secrets</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="option-1-automatically-set-up-azure-ad-using-terraform">Option 1: Automatically set up Azure AD using terraform<a class="hash-link" href="#option-1-automatically-set-up-azure-ad-using-terraform" title="Direct link to heading">​</a></h2><p>This is the easiest way to set up the Service Principals in Azure Active Directory, but it requires that the following tools are installed:</p><ul><li>Azure CLI: required by Terraform</li><li>Terraform: used to create App Registrations and Service Principals in Azure AD</li><li>(optional) Github CLI: if secrets should be stored using the provided shell script</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="log-in-to-azure-cli">Log in to Azure CLI<a class="hash-link" href="#log-in-to-azure-cli" title="Direct link to heading">​</a></h3><p>Install and login to the <a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli" target="_blank" rel="noopener noreferrer">Azure CLI</a>. On a shell execute <code>az login</code> - your user must have &quot;Application Administrator&quot; rights in the Azure tenant.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="initialize-terraform">Initialize terraform<a class="hash-link" href="#initialize-terraform" title="Direct link to heading">​</a></h3><p>Assuming terraform is installed, simply <code>cd</code> to <code>resources/setup_azure_ad</code> (located in the repository root) and execute</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">terraform init</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="customize-variablestf">Customize <code>variables.tf</code><a class="hash-link" href="#customize-variablestf" title="Direct link to heading">​</a></h3><p>Please change variables in <a target="_blank" href="/edc-docs/assets/files/variables-c3b17d0ae06f322c8706bca0876f7f8f.tf">variables.tf</a> to reflect your local setup. Note that <code>tenant_id</code> and <code>gihub_repo</code> <strong>must</strong> be changed.
Note also that the terraform state file (<code>terraform.state</code>) will be stored locally in the same directory. This will contain sensitive information - <strong>do not check it in or otherwise share it</strong>!</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="run-terraform">Run <code>terraform</code><a class="hash-link" href="#run-terraform" title="Direct link to heading">​</a></h3><p>On a command line execute</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">terraform apply</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This will take some time, and once it has successfully completed, your Azure Active Directory should contain all the relevant App Registrations and Service Principals
needed for Github.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="update-github-secrets">Update Github Secrets<a class="hash-link" href="#update-github-secrets" title="Direct link to heading">​</a></h3><p><em>A Github user with permission to write secrets is required for this step!</em></p><p>This can be done manually using the Github website (<a href="https://docs.github.com/en/actions/security-guides/encrypted-secrets" target="_blank" rel="noopener noreferrer">see documentation</a>).
Alternatively there is a <a target="_blank" href="/edc-docs/assets/files/set-gh-secrets-7afea0579a9ec6bbefdea4d1e4deec85.sh">shell script</a> that will set all Github Secrets automatically. From the <code>resources/setup_azure_ad</code> directory simply execute
<code>./set-gh-secrets.sh</code> on a shell.</p><p><em>Requirements</em>:</p><ul><li>user must be logged in to <a href="https://cli.github.com/manual/gh_auth_login" target="_blank" rel="noopener noreferrer">Github CLI</a></li><li><code>terraform</code> must have completed successfully</li></ul><p>--&gt; continue with <a href="/edc-docs/docs/submodule/MinimumViableDataspace/docs/developer/continuous-deployment/continuous_deployment#deploy-common-cd-resources">setting up CI</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="option-2-manually-set-up-azure-ad-using-the-azure-portal">Option 2: Manually set up Azure AD using the Azure Portal<a class="hash-link" href="#option-2-manually-set-up-azure-ad-using-the-azure-portal" title="Direct link to heading">​</a></h2><p>In case you&#x27;re not comfortable with the Azure CLI or don&#x27;t want to install it, the App Registrations and Service Principals can also be set up manually using the Azure Portal.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-a-service-identity-for-github-actions">Create a Service Identity for GitHub Actions<a class="hash-link" href="#create-a-service-identity-for-github-actions" title="Direct link to heading">​</a></h3><p>Further documentation for the following steps can be found in the Microsoft Docs to <a href="https://docs.microsoft.com/azure/active-directory/develop/workload-identity-federation-create-trust-github" target="_blank" rel="noopener noreferrer">Configure an app to trust a GitHub repo</a>.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="create-app-registration-for-github-actions">Create App Registration for GitHub Actions<a class="hash-link" href="#create-app-registration-for-github-actions" title="Direct link to heading">​</a></h4><p>Sign in to the <a href="https://portal.azure.com/" target="_blank" rel="noopener noreferrer">Azure Portal</a>, navigate to <em>App registrations</em> and select <em>New registration</em>.</p><p>Register a new application:</p><ul><li><strong>Name</strong>: Provide a display name for the application, e.g. <em>&quot;MVD GitHub Actions App&quot;</em></li><li>In <strong>Supported Account Types</strong>, select <strong>Accounts in this organizational directory only</strong>.</li><li>Don&#x27;t enter anything for <strong>Redirect URI (optional)</strong>.</li></ul><p>Select <strong>Register</strong> to create the app registration.</p><p>Take note of the <em>Application (client) ID</em> (will be required to configure a GitHub secret below).</p><p>Next, we create two types of credentials: two federated credentials to authenticate GitHub Actions, and a client secret for Terraform (required as Terraform does not yet support Azure CLI login with a service principal).</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="configure-main-branch-credentials">Configure <code>main</code> Branch Credentials<a class="hash-link" href="#configure-main-branch-credentials" title="Direct link to heading">​</a></h4><p>Select the previously created application (e.g. <em>&quot;MVD GitHub Actions App&quot;</em>) and navigate to <strong>Certificates &amp; secrets</strong>.</p><p>Select <strong>Federated credentials</strong>, click <strong>Add credential</strong> and define the following values.</p><ul><li>For <strong>Federated credential scenario</strong>, select <strong>GitHub actions deploying Azure resources</strong>.</li><li>For <strong>Organization</strong>, add your GitHub organization. For example, your organization is <em>YourGitHubOrg</em> if the URL of your GitHub repository is <a href="https://github.com/YourGitHubOrg/MinimumViableDataspace" target="_blank" rel="noopener noreferrer">https://github.com/YourGitHubOrg/MinimumViableDataspace</a>.</li><li>For <strong>Entity Type</strong>, select <strong>Branch</strong>.</li><li>For <strong>GitHub branch name</strong>, enter <code>main</code>.</li><li>For <strong>Name</strong>, enter a name for the credential, e.g. <em>&quot;mvd-main-branch&quot;</em>.</li></ul><p><img loading="lazy" alt="main branch credential" src="/edc-docs/assets/images/main-branch-credential-02039b4d0399d12359bfa5b2675a92e2.png" width="880" height="837" class="img_ev3q"></p><p>Click <strong>Add</strong> to create the credential.</p><p>ℹ️ <em>Note: You can add additional credentials to deploy from other branches</em></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="configure-pull-request-credentials">Configure Pull Request Credentials<a class="hash-link" href="#configure-pull-request-credentials" title="Direct link to heading">​</a></h4><p>Now, we set up a federated credential for pull requests, which allows to run a cloud deployment to validate pull requests.</p><p>ℹ️ <em>Note: This step is only required if you plan to create pull requests for the MVD.</em></p><p>Click <strong>Add credential</strong> to add another credential (for the previously created application (e.g. <em>&quot;MVD GitHub Actions App&quot;</em>), under <strong>Certificates &amp; secrets</strong>, <strong>Federated credentials</strong>).</p><ul><li>For <strong>Federated credential scenario</strong>, select <strong>GitHub actions deploying Azure resources</strong>.</li><li>For <strong>Organization</strong>, add your GitHub organization. For example, your organization is <em>YourGitHubOrg</em> if the URL of your GitHub repository is <a href="https://github.com/YourGitHubOrg/MinimumViableDataspace" target="_blank" rel="noopener noreferrer">https://github.com/YourGitHubOrg/MinimumViableDataspace</a>.</li><li>For <strong>Entity Type</strong>, select <strong>Pull Request</strong>.</li><li>For <strong>Name</strong>, enter a name for the credential, e.g. <em>&quot;mvd-pull-requests&quot;</em>.</li></ul><p><img loading="lazy" alt="PR credential" src="/edc-docs/assets/images/pr-credential-c77f607b7383800c74691e92b5a77730.png" width="873" height="791" class="img_ev3q"></p><p>Click <strong>Add</strong> to create the credential.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="grant-permissions-for-azure-subscription">Grant Permissions for Azure Subscription<a class="hash-link" href="#grant-permissions-for-azure-subscription" title="Direct link to heading">​</a></h4><p>To allow GitHub Actions to deploy resources to your Azure subscription, grant the application created above Owner permissions on your Azure subscription.
Further documentation for the following steps can be found under <a href="https://docs.microsoft.com/azure/role-based-access-control/role-assignments-portal" target="_blank" rel="noopener noreferrer">Assign Azure roles using the Azure portal</a>.</p><p>Navigate to your <strong>subscription</strong> you want to deploy the MVD resources to, select <strong>Access control (IAM)</strong> and click on <strong>Add role assignment</strong>.</p><p><img loading="lazy" alt="Subscription IAM" src="/edc-docs/assets/images/subscription-IAM-76b345bd3b5303ca5ac68d6ef7f95a22.png" width="1098" height="591" class="img_ev3q"></p><p>On the <strong>Add role assignment</strong> page, select <strong>Owner</strong> and click <strong>Next</strong>.</p><p>Now click on <strong>Select members</strong>, search for the application created above (e.g. <em>&quot;MVD GitHub Actions App&quot;</em>), click <strong>Select</strong> and then click on <strong>Next</strong> and then on <strong>Review + assign</strong> to assign the application Owner permissions on your Azure subscription.</p><p><img loading="lazy" alt="Add role assignment" src="/edc-docs/assets/images/add-role-assignment-b0e7dd05e64a139ce22072d7244926be.png" width="977" height="583" class="img_ev3q"></p><p>⚠️ You need to enter the full application name when searching for the application, the application will not show up if you only enter a partial name (e.g. <em>&quot;MVD GitHub Act&quot;</em> in the example above).</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="configure-github-secrets-for-github-actions">Configure GitHub Secrets for GitHub Actions<a class="hash-link" href="#configure-github-secrets-for-github-actions" title="Direct link to heading">​</a></h4><p>Finally, the application (client) ID needs to be made available to your GitHub repository using <a href="https://docs.github.com/en/actions/security-guides/encrypted-secrets" target="_blank" rel="noopener noreferrer">GitHub secrets</a>.</p><p>To configure GitHub Secrets, navigate to your <code>MinimumViableDataspace</code> repository, select <strong>Settings</strong>, navigate to <strong>Secrets</strong> and then <strong>Actions</strong>, and click <strong>New repository secret</strong> to create a new secret.</p><p><img loading="lazy" alt="GitHub Actions secrets" src="/edc-docs/assets/images/GitHub-Actions-secrets-ad5502c31baca1aa85b2aa7a70407a04.png" width="1457" height="1044" class="img_ev3q"></p><p>Configure the following GitHub secrets with the value from the steps above:</p><table><thead><tr><th>Secret name</th><th>Value</th></tr></thead><tbody><tr><td><code>ARM_CLIENT_ID</code></td><td>The application (client) ID of the application created above (e.g. <em>&quot;MVD GitHub Actions App&quot;</em>).</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-service-identity-for-mvd-runtimes">Create Service Identity for MVD Runtimes<a class="hash-link" href="#create-service-identity-for-mvd-runtimes" title="Direct link to heading">​</a></h3><p>Further documentation for the following steps can be found in the Microsoft Docs to <a href="https://docs.microsoft.com/azure/active-directory/develop/workload-identity-federation-create-trust-github" target="_blank" rel="noopener noreferrer">Create and configure an Azure AD application for the application runtimes</a>.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="create-app-registration-for-mvd-runtimes">Create App Registration for MVD Runtimes<a class="hash-link" href="#create-app-registration-for-mvd-runtimes" title="Direct link to heading">​</a></h4><p>Sign in to the <a href="https://portal.azure.com/" target="_blank" rel="noopener noreferrer">Azure Portal</a>, navigate to <em>App registrations</em> and select <em>New registration</em>.</p><p>Register a new application:</p><ul><li><strong>Name</strong>: Provide a display name for the application, e.g. <em>&quot;MVD Runtimes App&quot;</em></li><li>In <strong>Supported Account Types</strong>, select <strong>Accounts in this organizational directory only</strong>.</li><li>Don&#x27;t enter anything for <strong>Redirect URI (optional)</strong>.</li></ul><p>Select <strong>Register</strong> to create the app registration.</p><p>Take note of the <em>Application (client) ID</em> (will be required to configure a GitHub secret below).</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="create-client-secret-for-mvd-runtimes">Create Client Secret for MVD Runtimes<a class="hash-link" href="#create-client-secret-for-mvd-runtimes" title="Direct link to heading">​</a></h4><p>Navigate to <strong>Certificates &amp; secrets</strong> and then to the <strong>Client secrets</strong> tab (for the previously created application (e.g. <em>&quot;MVD Runtimes App&quot;</em>), and select <strong>New client secret</strong>. Create a new client secret by entering a <strong>Description</strong> (e.g. <em>&quot;mvd-runtimes-app-client-secret&quot;</em>) and clicking <strong>Add</strong>.</p><p>Take note of the client secret (<strong>Value</strong>) and keep it safe (will be required to configure a GitHub secret below).</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="get-application-object-id">Get Application Object ID<a class="hash-link" href="#get-application-object-id" title="Direct link to heading">​</a></h4><p>Navigate to <strong>Azure Active Directory</strong> and select <strong>Enterprise Applications</strong>.</p><p>Take note of the enterprise application <strong>Object ID</strong>.</p><p>⚠️ Make sure you use the Object ID of the <em>Enterprise application</em>, and not the Object ID of the <em>App Registration</em>!</p><p><img loading="lazy" alt="Application Object ID" src="/edc-docs/assets/images/application-object-ID-8ee95feb6b5454655a7493e906ae9701.png" width="1237" height="450" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="configure-github-secrets-for-mvd-runtimes">Configure GitHub Secrets for MVD Runtimes<a class="hash-link" href="#configure-github-secrets-for-mvd-runtimes" title="Direct link to heading">​</a></h4><p>Configure the following GitHub secrets with the values from the steps above:</p><table><thead><tr><th>Secret name</th><th>Value</th></tr></thead><tbody><tr><td><code>APP_CLIENT_ID</code></td><td>The application (client) ID.</td></tr><tr><td><code>APP_CLIENT_SECRET</code></td><td>The application client secret.</td></tr><tr><td><code>APP_OBJECT_ID</code></td><td>The ID of the service principal object associated with this application.</td></tr></tbody></table><p>See instructions under <a href="#configure-github-secrets-for-github-actions">Configure GitHub Secrets for GitHub Actions</a> on how to configure GitHub secrets.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="configure-cd-settings">Configure CD Settings<a class="hash-link" href="#configure-cd-settings" title="Direct link to heading">​</a></h3><p>Configure the following GitHub secrets which are required by the CD pipeline:</p><table><thead><tr><th>Secret name</th><th>Value</th></tr></thead><tbody><tr><td><code>ARM_TENANT_ID</code></td><td>The Azure Active Directory <strong>Tenant ID</strong>. Navigate to Azure Active Directory and copy the Tenant ID from the <em>Overview</em> page.</td></tr><tr><td><code>ARM_SUBSCRIPTION_ID</code></td><td>The Azure <strong>Subscription ID</strong> to deploy resources to. Navigate to Subscriptions and copy the <em>Subscription ID</em> of your subscription.</td></tr><tr><td><code>COMMON_RESOURCE_GROUP</code></td><td>The Azure resource group name to deploy common resources to, such as Azure Container Registry. Choose any valid resource group name, e.g. <em>rg-mvd-common</em>.</td></tr><tr><td><code>COMMON_RESOURCE_GROUP_LOCATION</code></td><td>The location where common resources should be deployed to, e.g. <em>eastus</em>.</td></tr><tr><td><code>ACR_NAME</code></td><td>The name of the Azure Container Registry to deploy. Use only lowercase letters and numbers.</td></tr><tr><td><code>TERRAFORM_STATE_STORAGE_ACCOUNT</code></td><td>The name of the storage account used to store the Terraform state container, e.g. <em>mvdterraformstates</em>.</td></tr><tr><td><code>TERRAFORM_STATE_CONTAINER</code></td><td>The name of the container used to store the Terraform state blob, e.g. <em>mvdterraformstates</em>.</td></tr></tbody></table><p>Update the value of the <code>CD_RESOURCES_PREFIX</code> env in the <a target="_blank" href="/edc-docs/assets/files/cloud-cd-e5933ec5bbd6b67b0c81a38a054997a8.yaml">cloud-cd.yaml</a> file.
This prefix allows to have unique resource names across fork repositories when running CD workflows.</p><p>See instructions under <a href="#configure-github-secrets-for-github-actions">Configure GitHub Secrets for GitHub Actions</a> on how to configure GitHub secrets.</p><p>For further information on Azure resouce naming, please refer to <a href="https://docs.microsoft.com/en-us/azure/cloud-adoption-framework/ready/azure-best-practices/resource-naming" target="_blank" rel="noopener noreferrer">naming conventions</a> and <a href="https://docs.microsoft.com/en-us/azure/azure-resource-manager/management/resource-name-rules" target="_blank" rel="noopener noreferrer">naming rules and restrictions for Azure resources</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="deploy-common-cd-resources">Deploy Common CD Resources<a class="hash-link" href="#deploy-common-cd-resources" title="Direct link to heading">​</a></h2><p>Common resources need to be deployed once, these resources will be used by all CD pipelines.</p><p>Manually run the <code>Initialize CD</code> GitHub Actions workflow and make sure that it passes successfully.</p><p>Your infrastructure is now set up to run deployments, you can now e.g. run the <code>Deploy</code> GitHub Actions workflow.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="azure-location-for-mvd-deployments">Azure Location for MVD Deployments<a class="hash-link" href="#azure-location-for-mvd-deployments" title="Direct link to heading">​</a></h2><p>To change the location where MVD instances will be deployed to, you can optionally change the location in the <a href="/edc-docs/docs/submodule/MinimumViableDataspace/deployment/terraform/dataspace/variables.tf">variables.tf file</a> for the dataspace authority and in the <a href="/edc-docs/docs/submodule/MinimumViableDataspace/deployment/terraform/participant/variables.tf">variables.tf file</a> for dataspace participants.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/FraunhoferISST/edc-docs/tree/master/docs/submodule/MinimumViableDataspace/docs/developer/continuous-deployment/continuous_deployment.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#planning-your-deployment" class="table-of-contents__link toc-highlight">Planning Your Deployment</a></li><li><a href="#option-1-automatically-set-up-azure-ad-using-terraform" class="table-of-contents__link toc-highlight">Option 1: Automatically set up Azure AD using terraform</a><ul><li><a href="#log-in-to-azure-cli" class="table-of-contents__link toc-highlight">Log in to Azure CLI</a></li><li><a href="#initialize-terraform" class="table-of-contents__link toc-highlight">Initialize terraform</a></li><li><a href="#customize-variablestf" class="table-of-contents__link toc-highlight">Customize <code>variables.tf</code></a></li><li><a href="#run-terraform" class="table-of-contents__link toc-highlight">Run <code>terraform</code></a></li><li><a href="#update-github-secrets" class="table-of-contents__link toc-highlight">Update Github Secrets</a></li></ul></li><li><a href="#option-2-manually-set-up-azure-ad-using-the-azure-portal" class="table-of-contents__link toc-highlight">Option 2: Manually set up Azure AD using the Azure Portal</a><ul><li><a href="#create-a-service-identity-for-github-actions" class="table-of-contents__link toc-highlight">Create a Service Identity for GitHub Actions</a></li><li><a href="#create-service-identity-for-mvd-runtimes" class="table-of-contents__link toc-highlight">Create Service Identity for MVD Runtimes</a></li><li><a href="#configure-cd-settings" class="table-of-contents__link toc-highlight">Configure CD Settings</a></li></ul></li><li><a href="#deploy-common-cd-resources" class="table-of-contents__link toc-highlight">Deploy Common CD Resources</a></li><li><a href="#azure-location-for-mvd-deployments" class="table-of-contents__link toc-highlight">Azure Location for MVD Deployments</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 My Project,  built with Fraunhofer ISST.</div></div></div></footer></div>
<script src="/edc-docs/assets/js/runtime~main.bbc09bb1.js"></script>
<script src="/edc-docs/assets/js/main.bdd0bebb.js"></script>
</body>
</html>