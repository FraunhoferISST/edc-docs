function nextForState(e,t,o){var n=getContext(),a=n.getCollection(),l=a.getSelfLink(),s=n.getResponse(),r={query:"SELECT * FROM t WHERE t.wrappedInstance.state = @state AND (t.lease = null OR (t.lease.leasedAt + t.lease.leaseDuration) < @now) ORDER BY t.wrappedInstance.stateTimestamp OFFSET 0 LIMIT @limit",parameters:[{name:"@state",value:parseInt(e,10)},{name:"@limit",value:parseInt(t,10)},{name:"@leaser",value:o},{name:"@now",value:Date.now()}]};if(!a.queryDocuments(l,r,{},(function(e,t,n){if(e)throw new Error("Error"+e.message);(!t||!t.length||t.length<=0)&&(s.setBody("no docs found"),console.log("No documents found!")),console.log("found "+t.length+" documents!");for(var a=0;a<t.length;a++)u(t[a],o);s.setBody(t)})))throw"Unable to read document details, abort ";function u(e,t){if(e.lease={leasedBy:t,leasedAt:Date.now(),leaseDuration:6e4},!a.replaceDocument(e._self,e,(function(e,t){if(e)throw"Unable to update Document, abort "})))throw"Unable to update Document, abort";console.log("updated lease of document "+e.id)}}